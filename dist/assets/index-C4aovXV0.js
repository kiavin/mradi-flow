import{ap as K,ac as Q,av as W,af as u,ag as E,ar as X,aw as Z,ai as F,a3 as aa,a4 as ea,a5 as y,a7 as P,a8 as b,a9 as S,ah as L,ax as M}from"./index-D2aSRXYT.js";import{_ as O}from"./BaseButton-BJlAQNhW.js";import{_ as $}from"./form-D7be2dMS.js";/* empty css                                                                  */import"./SelectComponent-Dd3exPW7.js";const ta={class:"card p-3"},oa={class:"row d-flex justify-content-between align-items-center mb-3"},na={class:"col-auto mb-4"},sa="/v1/project/projects",q="/v1/project/financiers",pa={__name:"index",setup(ra){const{proxy:_}=K(),D=Q(),r=W(),{data:o,request:m,refresh:C,isLoading:N,error:B}=u(sa,{method:"GET",options:{},autoFetch:!1}),l=E({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:20,totalCount:0,totalPages:0,paginationLinks:{}}}),U=[{key:"name",label:"Name"},{key:"bid_amount",label:"Bid Amount"},{key:"total_financiers",label:"Total Financiers"},{key:"total_expenses",label:"Total Expenses"}],d=E([]);X(o,()=>{v()});const v=()=>{var e;if((e=o.value)!=null&&e.dataPayload){const a=o.value.dataPayload.data;let t=[];typeof a=="object"&&!Array.isArray(a)?t=Object.values(a):Array.isArray(a)&&(t=a),l.value={data:t,paginationData:{countOnPage:o.value.dataPayload.countOnPage||0,currentPage:o.value.dataPayload.currentPage||1,perPage:o.value.dataPayload.perPage||l.value.paginationData.perPage,totalCount:o.value.dataPayload.totalCount||0,totalPages:o.value.dataPayload.totalPages||0,paginationLinks:o.value.dataPayload.paginationLinks||{}}}}},R=async e=>{const a=e.id;console.log("fff",a),D.push({name:"projectDashboard",params:{id:a}})},p=E({}),V=async e=>{var h,j,A,k;const a=e.id;if(p.value={},r.toggleModalUsage(!0),await M(),!r.useModal){D.push({name:"project/project/update",params:{id:a}});return}const t=`/v1/project/project/${a}`,{data:n,request:f,isLoading:c}=u(t,{method:"GET",options:{},autoFetch:!0,autoAlert:!0});await f();const{data:i,request:g}=u(q,{method:"GET",autoFetch:!0,autoAlert:!1});await g(),(j=(h=i.value)==null?void 0:h.dataPayload)!=null&&j.data?d.value=i.value.dataPayload.data.map(w=>({value:w.id,label:w.name})):console.warn("Could not load financiers:",i.value),console.log("Financier Options:",d.value);const s=async w=>{const{request:J,error:x}=u(t,{method:"PUT"});if(await J(w),x.value){console.log("Error",x.value),p.value=x.value;return}r.closeModal(),C()};r.openModal($,{formData:((k=(A=n.value)==null?void 0:A.dataPayload)==null?void 0:k.data)||{},Financiers:d.value,error:p,isLoading:c,readonly:!1,hideSubmit:!1,onSubmit:s},"Edit Project")},T=async()=>{var n,f;if(p.value={},r.toggleModalUsage(!0),await M(),!r.useModal){D.push({name:"project/project/create"});return}const{data:e,request:a}=u(q,{method:"GET",autoFetch:!0,autoAlert:!1});await a(),(f=(n=e.value)==null?void 0:n.dataPayload)!=null&&f.data?d.value=e.value.dataPayload.data.map(c=>({value:c.id,label:c.name})):console.warn("Could not load financiers:",e.value),console.log("Financier Options:",d.value);const t=async c=>{const i="/v1/project/project",{request:g,error:s}=u(i,{method:"POST",autoAlert:!0});if(await g(c),s.value){console.log("Error",s.value),p.value=s.value;return}r.closeModal(),C()};r.openModal($,{formData:{},error:p,Financiers:d.value,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:t},"Create Project")},G=async e=>{var i,g;const a=e.id,t=e.is_deleted,n=t?"Restore":"Delete",f=t?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await _.$showAlert({title:"Are you sure?",text:f,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${n} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:s,request:h,isLoading:j}=u(`/v1/project/project/${a}`,{method:"DELETE"});await h(),s.value&&await _.$showAlert({title:`${n}d!`,text:((g=(i=s.value)==null?void 0:i.alertifyPayload)==null?void 0:g.message)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",B),await _.$showAlert({title:"Error!",text:`Error deleting record: ${B.value}`,icon:"error",showCancelButton:!1})}finally{await C()}else console.log("Deletion cancelled")},Y=e=>{m(null,{page:l.value.paginationData.currentPage,"per-page":l.value.paginationData.perPage,q:e})},z=async e=>{await m(null,{page:e,"per-page":l.value.paginationData.perPage}),v(),console.log("Page changed to: ",o.value)},I=async e=>{l.value.paginationData.perPage=e,await m(null,{page:l.value.paginationData.currentPage,"per-page":e}),v()},H=[];return Z(()=>{m().then(()=>{v()})}),(e,a)=>{const t=F("font-awesome-icon"),n=F("OmniGridView");return ea(),aa("div",ta,[y("div",oa,[a[2]||(a[2]=y("div",{class:"col-auto"},[y("h1",{class:"h4 mt-2"},"List of Project")],-1)),y("div",na,[P(O,{type:"submit",customClass:"btn btn-primary",onClick:T},{default:b(()=>a[0]||(a[0]=[S(" New Project ")])),_:1})]),P(n,{columns:U,data:l.value,loading:L(N),"action-layout":"inline","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!1},"expandable-rows":!1,filtering:!1,rowSize:"sm",striped:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!1,"search-in-backend":!0,showEdit:!1,showDelete:!1,actions:H,onView:R,onEdit:V,onDelete:G,onSearch:Y,onChangePage:z,"onUpdate:perPage":I,onRefresh:L(m)},{"left-buttons":b(()=>[P(O,{class:"btn btn-success btn-sm",onClick:T,style:{"font-size":"1.2rem"}},{icon:b(()=>[P(t,{icon:["fas","plus"]})]),default:b(()=>[a[1]||(a[1]=S(" New Project "))]),_:1})]),_:1},8,["data","loading","onRefresh"])])])}}};export{pa as default};
