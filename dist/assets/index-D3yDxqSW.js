import{e as I}from"./vue3-autocounter-PIfJaUda.js";import{_ as G,b as z}from"./index-BhZ2WKwH.js";import{aj as d,k as X,e as w,D as r,i as t,O as n,x as i,M as g,r as y,a2 as Y,o as tt,a as N,C as T,F as B,u as K,P as et,q as ot}from"./@vue-D5jJVPgi.js";import"./pinia-BWRdMQcg.js";import"./bootstrap-r_TW8pGT.js";import"./@popperjs-BEKk9TLb.js";import"./bootstrap-vue-next-CI7J1iGq.js";import"./izitoast-CqdWWGAA.js";import"./sweetalert2-89IKscqO.js";import"./@fortawesome-BMRTUbaC.js";import"./jspdf-BHjgPkY0.js";import"./@babel-BgpAVVkQ.js";import"./fflate-DE92GPtl.js";import"./@vueuse-BFKO5FPz.js";import"./xlsx-VQGdcWwX.js";import"./jspdf-autotable-DwCSpOYb.js";import"./@tsparticles-RHRfPQQI.js";import"./pinia-plugin-persistedstate-BuM6D3kL.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./vue-router-Ds9KUoJm.js";import"./lodash-CW-aI5JM.js";import"./crypto-js-C9xuVu9R.js";import"./axios-xsH4HHeE.js";import"./qs-Dop67Io4.js";import"./side-channel-DfNisRws.js";import"./es-errors-CxTyLFAO.js";import"./object-inspect-CwG9orBb.js";import"./side-channel-list-CVgrowBt.js";import"./side-channel-map-Czb7NFry.js";import"./get-intrinsic-BpLglCTt.js";import"./es-object-atoms-BR76m4z7.js";import"./math-intrinsics-DP1tGiab.js";import"./gopd-C1lCZ5Qs.js";import"./es-define-property-D_7cP-M3.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-Cd0SCNDH.js";import"./dunder-proto-DSwuxXkl.js";import"./call-bind-apply-helpers-VtLnLD2e.js";import"./function-bind-CHqF18-c.js";import"./hasown-DwiY0sux.js";import"./call-bound-BuGV4nFB.js";import"./side-channel-weakmap-DmcBNuf_.js";import"./smooth-scrollbar-CSiRJ_Pw.js";import"./core-js-BA3D9nVJ.js";import"./@vueform-b-21xuRD.js";import"./vue3-circle-progress-DRe7pzrA.js";import"./vue-Aiaqh0QQ.js";import"./vue3-apexcharts-CSHbnzTQ.js";import"./apexcharts-AYwITVQt.js";const nt={components:{Vue3autocounter:I},props:{title:{type:String,default:""},buttonText:{type:String,default:""},buttonLink:{type:String,default:"javascript:void(0);"},amount:{type:[String,Number],default:"0"},description:{type:String,default:""},prefix:{type:String,default:""}}},at={class:"mb-2 d-flex justify-content-between align-items-center"},st={class:"text-dark"},rt={class:"counter"};function it(W,v,u,S,C,h){const E=d("b-badge"),L=d("Vue3autocounter"),k=d("b-card");return w(),X(k,{class:"card-block card-stretch card-height"},{default:r(()=>[t("div",at,[t("span",st,i(u.title),1),n(E,{tag:"a",variant:" bg-primary-subtle",pill:"",href:u.buttonLink},{default:r(()=>[g(i(u.buttonText),1)]),_:1},8,["href"])]),t("h2",rt,[n(L,{ref:"counter",separator:",",prefix:u.prefix,duration:3,startAmount:0,endAmount:u.amount},null,8,["prefix","endAmount"])]),t("small",null,i(u.description),1)]),_:1})}const $=G(nt,[["render",it]]),lt={class:"d-flex align-items-start justify-content-between mb-2"},ct={class:"mb-3"},dt={class:"counter text-success"},ut=["src"],mt={class:"mb-1 text-dark"},pt={class:"mb-4"},bt={class:"text-dark"},ft={class:"row"},_t={class:"col-sm-6 mb-3"},ht={class:"d-flex align-items-start gap-3"},gt={class:"bg-info-subtle avatar-50 rounded d-flex align-items-center justify-content-center"},vt={class:"mb-0 text-body"},xt={class:"col-sm-6 mb-3"},yt={class:"d-flex align-items-start gap-3"},wt={class:"bg-success-subtle avatar-50 rounded d-flex align-items-center justify-content-center"},At={class:"mb-0 text-body"},Nt={class:"col-md-12 col-lg-12"},St={class:"overflow-hidden card","data-aos":"fade-up","data-aos-delay":"600"},jt={class:"p-0 card-body"},Tt={class:"mt-4 table-responsive mb-0",style:{"max-height":"580px","overflow-y":"auto"}},Ct={id:"projects-table",class:"table mb-0 table-striped",role:"grid"},Et={class:"d-flex align-items-center"},Lt=["src"],kt={class:"mb-2 d-flex align-items-center"},Pt={class:"shadow-none progress bg-primary-subtle w-100",style:{height:"4px"}},Dt=["aria-valuenow"],Ft={class:"col-md-12 col-lg-12"},Bt={class:"ms-4"},It={class:"mb-1"},Mt={class:"fw-bold"},Ot={class:"text-muted"},Vt={class:"text-muted"},J=25e5,q=15e5,Rt={__name:"index",setup(W){const v=y({totalProjects:0,totalFinanciers:0,totalExpenses:0,totalContributions:0,totalProjectsBid:0,totalContributed:0,lastUpdated:E(new Date)}),u=y([]),S=y([]),C=Array(12).fill(0),h=y("");function E(c){const o=new Date,a=new Date(c),m=Math.floor((o-a)/1e3),p=[{name:"year",seconds:31536e3},{name:"month",seconds:2592e3},{name:"week",seconds:604800},{name:"day",seconds:86400},{name:"hour",seconds:3600},{name:"minute",seconds:60},{name:"second",seconds:1}];for(const e of p)if(m>=e.seconds){const l=Math.floor(m/e.seconds);return new Intl.RelativeTimeFormat("en",{numeric:"auto"}).format(-l,e.name)}return"just now"}const L=async()=>{var x,b,s,A,j,O,V,R;const{data:c,request:o}=z("v1/project/report/summary",{method:"GET",autoFetch:!0,autoAlert:!1});await o(),k(),v.value.lastUpdated=new Date().toLocaleString();const a=(b=(x=c.value)==null?void 0:x.dataPayload)==null?void 0:b.data;if(!a){console.warn("Missing dashboard data");return}v.value={totalProjects:Number(a.total_projects),totalExpenses:Number(a.total_expenses),totalFinanciers:Number(a.total_financiers),totalContributions:Number(a.total_contributions),totalProjectsBid:Number(a.total_bid_amount)};const m=(s=a.last_contribution)==null?void 0:s.created_at,p=Number.isFinite(Number(m));h.value={contributor:((A=a.last_contribution)==null?void 0:A.financier_name)||"N/A",avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(((j=a.last_contribution)==null?void 0:j.financier_name)||"N/A")}&background=0D8ABC&color=fff`,project:((O=a.last_contribution)==null?void 0:O.project_name)||"N/A",expense:((V=a.last_contribution)==null?void 0:V.expense_name)||"N/A",amount:Number(((R=a.last_contribution)==null?void 0:R.amount)||0),date:p?new Date(Number(m)*1e3).toISOString():"-"};const e=Number(a.total_contributions||0),l=Number(a.total_expenses||0),f=e+l||1;Z.value.series=[Math.round(e/f*100),Math.round(l/f*100)],Array.isArray(a.projects)?u.value=a.projects.map((_,Ut)=>{const U=Number(_.bid_amount||0),F=Number(_.sum_expenses||0),Q=U===0||F===0?0:Math.round(_.total_contributions/F*100);return{id:_.project_id,name:_.project_name,avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent((_==null?void 0:_.project_name)||"Project")}&background=1AA053&color=fff&bold=true&size=128`,contributions:_.total_contributions,expense:F,contribution:U,contributionPercent:Q}}):(console.warn("Expected `projects` to be an array in summary response"),u.value=[])},k=async()=>{var m,p;const{data:c,request:o}=z("/v1/project/expense-contributions",{method:"GET",autoFetch:!0,autoAlert:!1});await o();const a=(p=(m=c.value)==null?void 0:m.dataPayload)==null?void 0:p.data;if(!Array.isArray(a)){console.warn("Expected an array for contributions, but got:",a),S.value=[];return}S.value=a.map(e=>{const l=isNaN(Number(e==null?void 0:e.amount))?0:Number(e.amount),f=(e==null?void 0:e.expense_name)||"Unknown Expense",x=(e==null?void 0:e.financier_name)||"Unknown Financier",b=(e==null?void 0:e.project_name)||"Unknown Project",s=e==null?void 0:e.created_at,j=typeof s=="number"&&s>0?new Date(s*1e3).toISOString():new Date().toISOString();return{amount:l,expense:f,contributor:x,project:b,date:j}}),a.forEach(e=>{const l=e==null?void 0:e.created_at,f=parseFloat(e==null?void 0:e.amount)||0;if(typeof l=="number"&&l>0){const b=new Date(l*1e3).getMonth();b>=0&&b<=11&&(C[b]+=f)}}),P.contributions.series[0].data=C},P=Y({contributions:{series:[{name:"Contributions",data:[]}],options:{chart:{type:"bar",height:120,toolbar:{show:!1}},plotOptions:{bar:{columnWidth:"45%",borderRadius:4}},colors:["#2dce89","#5e72e4"],xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},dataLabels:{enabled:!1},legend:{show:!1}}}}),M=J+q,Z=y({series:[Math.round(J/M*100),Math.round(q/M*100)],options:{chart:{height:230,type:"radialBar"},plotOptions:{radialBar:{offsetY:0,startAngle:0,endAngle:270,hollow:{margin:5,size:"30%"},dataLabels:{name:{show:!1},value:{fontSize:"18px",formatter:c=>`${c}%`}}}},colors:["#0d6efd","#dc3545"],labels:["Funding","Spending"],legend:{show:!1}}});y(16);function D(c){return new Intl.NumberFormat("en-KE").format(c)}function H(c){const o=new Date(c);return`${o.toLocaleDateString()} at ${o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}return tt(L),(c,o)=>{const a=d("b-badge"),m=d("apexchart"),p=d("b-card"),e=d("b-col"),l=d("b-row"),f=d("font-awesome-icon"),x=d("b-card-header"),b=d("b-card-body");return w(),N(B,null,[o[12]||(o[12]=t("div",{class:"d-flex justify-content-between align-items-center flex-wrap mb-4 gap-3"},[t("div",{class:"d-flex flex-column"},[t("h3",null,"Quick Insights"),t("p",{class:"text-primary mb-0"},"Financial Dashboard")])],-1)),n(l,null,{default:r(()=>[n(e,{lg:"3",md:"6"},{default:r(()=>[n(p,{class:"card-block card-stretch card-height"},{default:r(()=>[t("div",lt,[o[1]||(o[1]=t("p",{class:"mb-0 text-dark"},"Total Contributions",-1)),n(a,{tag:"a",variant:"bg-primary-subtle",class:"badge rounded-pill",href:"javascript:void(0);"},{default:r(()=>o[0]||(o[0]=[g(" View ")])),_:1})]),t("div",ct,[t("h2",dt,[n(T(I),{ref:"contributionCounter",separator:",",prefix:"KES ",duration:3,startAmount:0,endAmount:v.value.totalContributions},null,8,["endAmount"])]),t("small",null,"Updated "+i(v.value.lastUpdated),1)]),t("div",null,[n(m,{height:"100%",type:"bar",options:T(P).contributions.options,series:T(P).contributions.series},null,8,["options","series"])])]),_:1})]),_:1}),n(e,{lg:"3",md:"6"},{default:r(()=>[n(l,{class:"row"},{default:r(()=>[n(e,{cols:"12"},{default:r(()=>[n($,{title:"Total Project Bids",amount:v.value.totalProjectsBid,description:"Registered under this project",icon:"box","button-text":"View"},null,8,["amount"])]),_:1}),n(e,{cols:"12"},{default:r(()=>[n($,{prefix:"KES ",title:"Total Expenses",amount:v.value.totalExpenses,description:"Project Bid Amount",icon:"file-invoice-dollar","button-text":"View"},null,8,["amount"])]),_:1})]),_:1})]),_:1}),n(e,{lg:"6",md:"12"},{default:r(()=>[n(p,{class:"shadow-sm border-0"},{default:r(()=>[n(a,{tag:"a",variant:" bg-primary-subtle",class:"badge rounded-pill",href:"javascript:void(0);"},{default:r(()=>o[2]||(o[2]=[g(" Last Transaction ")])),_:1}),n(l,null,{default:r(()=>[n(e,{md:"4",class:"d-flex flex-column align-items-center justify-content-center text-center p-4 border-end"},{default:r(()=>[t("img",{src:h.value.avatar,alt:"financier",class:"rounded-circle shadow avatar-100 mb-3 bg-light",style:{"object-fit":"cover"}},null,8,ut),t("h5",mt,i(h.value.contributor),1),o[3]||(o[3]=t("p",{class:"text-muted mb-2"},"Financier",-1)),n(a,{variant:"primary-subtle",pill:""},{default:r(()=>[g(i(h.value.date),1)]),_:1})]),_:1}),n(e,{md:"8",class:"p-4"},{default:r(()=>[t("div",pt,[o[4]||(o[4]=t("h6",{class:"text-muted mb-1"},"Amount Contributed",-1)),t("h2",bt,[n(T(I),{ref:"counter",separator:",",prefix:"KES ",duration:3,startAmount:0,endAmount:h.value.amount},null,8,["endAmount"])])]),t("div",ft,[t("div",_t,[t("div",ht,[t("div",gt,[n(f,{icon:"building",size:"lg",class:"text-info"})]),t("div",null,[o[5]||(o[5]=t("p",{class:"mb-1 text-muted"},"Project",-1)),t("h6",vt,i(h.value.project),1)])])]),t("div",xt,[t("div",yt,[t("div",wt,[n(f,{icon:"box",size:"lg",class:"text-success"})]),t("div",null,[o[6]||(o[6]=t("p",{class:"mb-1 text-muted"},"Expense",-1)),t("h6",At,i(h.value.expense),1)])])])])]),_:1})]),_:1})]),_:1})]),_:1}),n(e,{lg:"8",md:"12"},{default:r(()=>[t("div",Nt,[t("div",St,[o[8]||(o[8]=t("div",{class:"flex-wrap card-header d-flex justify-content-between"},[t("div",{class:"header-title"},[t("h4",{class:"mb-2 card-title"},"Projects Financial Overview"),t("p",{class:"mb-0"},[t("svg",{class:"me-2 text-primary",width:"24",height:"24",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"})]),g(" Insights from latest project contributions ")])])],-1)),t("div",jt,[t("div",Tt,[t("table",Ct,[o[7]||(o[7]=t("thead",null,[t("tr",null,[t("th",null,"PROJECT"),t("th",null,"TOTAL EXPENSE"),t("th",null,"CONTRIBUTIONS"),t("th",null,"CONTRIBUTION %")])],-1)),t("tbody",null,[(w(!0),N(B,null,K(u.value,s=>(w(),N("tr",{key:s.id},[t("td",null,[t("div",Et,[t("img",{class:"rounded bg-primary-subtle img-fluid avatar-40 me-3",src:s.avatar,alt:"project"},null,8,Lt),t("h6",null,i(s.name),1)])]),t("td",null,"KES "+i(D(s.expense)),1),t("td",null,"KES "+i(D(s.contributions)),1),t("td",null,[t("div",kt,[t("h6",null,i(s.contributionPercent)+"%",1)]),t("div",Pt,[t("div",{class:ot(["progress-bar",s.contributionPercent>=100?"bg-success":"bg-primary"]),role:"progressbar",style:et({width:s.contributionPercent+"%"}),"aria-valuenow":s.contributionPercent,"aria-valuemin":"0","aria-valuemax":"100"},null,14,Dt)])])]))),128))])])])])])])]),_:1}),n(e,{lg:"4",md:"12"},{default:r(()=>[t("div",Ft,[n(p,{"no-body":"",class:"aos-init aos-animate","data-aos":"fade-up","data-aos-delay":"600"},{default:r(()=>[n(x,{class:"d-flex justify-content-between flex-wrap"},{default:r(()=>o[9]||(o[9]=[t("div",{class:"header-title"},[t("h4",{class:"mb-2 card-title"},"Activity Overview"),t("p",{class:"mb-0 d-flex align-items-center"},[t("svg",{class:"me-2",width:"24",height:"24",viewBox:"0 0 24 24"},[t("path",{fill:"#17904b",d:"M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z"})]),g(" Recent Transactions ")])],-1)])),_:1}),n(b,{style:{"max-height":"600px","overflow-y":"auto"}},{default:r(()=>[(w(!0),N(B,null,K(S.value,(s,A)=>(w(),N("div",{key:A,class:"mb-3 d-flex profile-media align-items-top"},[o[11]||(o[11]=t("div",{class:"mt-1 profile-dots-pills border-primary"},null,-1)),t("div",Bt,[t("h6",It,[t("span",Mt,"KES "+i(D(s.amount)),1),o[10]||(o[10]=g(", ")),t("span",Ot,i(s.expense),1)]),t("small",Vt,[g(i(H(s.date))+" â€“ by "+i(s.contributor)+" for ",1),t("strong",null,i(s.project),1)])])]))),128))]),_:1})]),_:1})])]),_:1})]),_:1})],64)}}},Oe=G(Rt,[["__scopeId","data-v-66e0b246"]]);export{Oe as default};
