import{useRouter as W}from"./vue-router-Ds9KUoJm.js";import{_ as M}from"./BaseButton-WTmgFy-8.js";import{c as X,b as v}from"./index-BhZ2WKwH.js";import{_ as F}from"./form-B811fKPM.js";import{g as Z,r as h,w as tt,o as et,aj as O,a as at,e as ot,i as p,O as D,D as f,M as $,x as C,C as q,n as U}from"./@vue-D5jJVPgi.js";import"./pinia-BWRdMQcg.js";import"./bootstrap-r_TW8pGT.js";import"./@popperjs-BEKk9TLb.js";import"./bootstrap-vue-next-CI7J1iGq.js";import"./izitoast-CqdWWGAA.js";import"./sweetalert2-89IKscqO.js";import"./@fortawesome-BMRTUbaC.js";import"./jspdf-BHjgPkY0.js";import"./@babel-BgpAVVkQ.js";import"./fflate-DE92GPtl.js";import"./@vueuse-BFKO5FPz.js";import"./xlsx-VQGdcWwX.js";import"./jspdf-autotable-DwCSpOYb.js";import"./@tsparticles-RHRfPQQI.js";import"./pinia-plugin-persistedstate-BuM6D3kL.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./lodash-CW-aI5JM.js";import"./crypto-js-C9xuVu9R.js";import"./axios-xsH4HHeE.js";import"./qs-Dop67Io4.js";import"./side-channel-DfNisRws.js";import"./es-errors-CxTyLFAO.js";import"./object-inspect-CwG9orBb.js";import"./side-channel-list-CVgrowBt.js";import"./side-channel-map-Czb7NFry.js";import"./get-intrinsic-BpLglCTt.js";import"./es-object-atoms-BR76m4z7.js";import"./math-intrinsics-DP1tGiab.js";import"./gopd-C1lCZ5Qs.js";import"./es-define-property-D_7cP-M3.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-Cd0SCNDH.js";import"./dunder-proto-DSwuxXkl.js";import"./call-bind-apply-helpers-VtLnLD2e.js";import"./function-bind-CHqF18-c.js";import"./hasown-DwiY0sux.js";import"./call-bound-BuGV4nFB.js";import"./side-channel-weakmap-DmcBNuf_.js";import"./smooth-scrollbar-CSiRJ_Pw.js";import"./core-js-BA3D9nVJ.js";import"./@vueform-b-21xuRD.js";import"./vue3-circle-progress-DRe7pzrA.js";import"./vue-Aiaqh0QQ.js";import"./vue3-apexcharts-CSHbnzTQ.js";import"./apexcharts-AYwITVQt.js";import"./SelectComponent-CyRHSQTW.js";const rt={class:"card p-3"},nt={class:"row d-flex justify-content-between align-items-center mb-3"},st={class:"col-auto mb-4"},it={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},lt={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},ct={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},ut={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},dt="/v1/project/projects",R="/v1/project/financiers",de={__name:"index",setup(mt){const{proxy:j}=Z(),E=W(),A=h(!0),k=h(null);h(null);const u=X(),{data:l,request:y,refresh:B,isLoading:V,error:N}=v(dt,{method:"GET",options:{},autoFetch:!1}),d=h({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:25,totalCount:0,totalPages:0,paginationLinks:{}}}),G=[{key:"name",label:"Name",class:"text-center"},{key:"bid_amount",label:"Bid Amount",class:"text-center"},{key:"total_expense_amount",label:"Total Expenses",class:"text-center"},{key:"total_contributed_amount",label:"Total Contributions",class:"text-center"},{key:"deficit",label:"Deficit",class:"text-center"}],_=e=>{const t=Number(e);return isNaN(t)?"-":t.toLocaleString("en-KE")},b=h([]);tt(l,()=>{w()});const w=()=>{var e;if((e=l.value)!=null&&e.dataPayload){const t=l.value.dataPayload.data;let r=[],o=[];typeof t=="object"&&!Array.isArray(t)?r=Object.values(t):Array.isArray(t)&&(o=t,r=o.map(a=>{const n=Number(a.total_expense_amount)||0,s=Number(a.total_expenses)||0,c=n-s;return{...a,bid_amount:Number(a.bid_amount)||0,total_expense_amount:n,total_expenses:s,deficit:c}})),d.value={data:r,paginationData:{countOnPage:l.value.dataPayload.countOnPage||0,currentPage:l.value.dataPayload.currentPage||1,perPage:l.value.dataPayload.perPage||d.value.paginationData.perPage,totalCount:l.value.dataPayload.totalCount||0,totalPages:l.value.dataPayload.totalPages||0,paginationLinks:l.value.dataPayload.paginationLinks||{}}}}},Y=async e=>{const t=e.id;E.push({name:"projectDashboard",params:{id:t}})},g=h({}),z=async e=>{var s,c,i,x;const t=e.id;if(g.value={},u.toggleModalUsage(!0),await U(),!u.useModal){E.push({name:"project/project/update",params:{id:t}});return}const r=async m=>{const{request:T,error:P}=v(o,{method:"PUT"});if(await T(m),P.value){console.log("Error",P.value),g.value=P.value;return}u.closeModal(),B()};u.openModal(F,{formData:k,error:g,isLoading:A,prefill:!0,Financiers:b,readonly:!1,hideSubmit:!1,onSubmit:r},"Edit Project");const o=`/v1/project/project/${t}`,{data:a,request:n}=v(o,{method:"GET",autoFetch:!0,autoAlert:!0});try{A.value=!0,await n(),k.value=((c=(s=a==null?void 0:a.value)==null?void 0:s.dataPayload)==null?void 0:c.data)||{};const{data:m,request:T,error:P}=v(R,{method:"GET",autoFetch:!0,autoAlert:!1});await T(),Array.isArray((x=(i=m.value)==null?void 0:i.dataPayload)==null?void 0:x.data)?b.value=m.value.dataPayload.data.map(L=>({value:L.id,label:L.name})):console.warn("Could not load financiers:",m.value)}catch(m){console.error("Failed to fetch edit data",m),g.value.general="Could not load project data."}finally{A.value=!1}},S=async()=>{var o,a;if(g.value={},u.toggleModalUsage(!0),await U(),!u.useModal){E.push({name:"project/project/create"});return}const{data:e,request:t}=v(R,{method:"GET",autoFetch:!0,autoAlert:!1});await t(),Array.isArray((a=(o=e.value)==null?void 0:o.dataPayload)==null?void 0:a.data)?b.value=e.value.dataPayload.data.map(n=>({value:n.id,label:n.name})):console.warn("Could not load financiers:",e.value);const r=async n=>{const s="/v1/project/project",{request:c,error:i}=v(s,{method:"POST",autoAlert:!0});if(await c(n),i.value){console.log("Error",i.value),g.value=i.value;return}u.closeModal(),B()};u.openModal(F,{formData:{},error:g,Financiers:b.value,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:r},"Create Project")},I=async e=>{var s,c;const t=e.id,r=e.is_deleted,o=r?"Restore":"Delete",a=r?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await j.$showAlert({title:"Are you sure?",text:a,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${o} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:i,request:x,isLoading:m}=v(`/v1/project/project/${t}`,{method:"DELETE"});await x(),i.value&&await j.$showAlert({title:`${o}d!`,text:((c=(s=i.value)==null?void 0:s.alertifyPayload)==null?void 0:c.message)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",N),await j.$showAlert({title:"Error!",text:`Error deleting record: ${N.value}`,icon:"error",showCancelButton:!1})}finally{await B()}else console.log("Deletion cancelled")},K=e=>{y(null,{page:d.value.paginationData.currentPage,"per-page":d.value.paginationData.perPage,q:e})},H=async e=>{await y(null,{page:e,"per-page":d.value.paginationData.perPage}),w()},J=async e=>{d.value.paginationData.perPage=e,await y(null,{page:d.value.paginationData.currentPage,"per-page":e}),w()},Q=[];return et(()=>{y().then(()=>{w()})}),(e,t)=>{const r=O("font-awesome-icon"),o=O("OmniGridView");return ot(),at("div",rt,[p("div",nt,[t[2]||(t[2]=p("div",{class:"col-auto"},[p("h1",{class:"h4 mt-2"},"List of Project")],-1)),p("div",st,[D(M,{type:"submit",customClass:"btn btn-primary",onClick:S},{default:f(()=>t[0]||(t[0]=[$(" New Project ")])),_:1})]),D(o,{columns:G,data:d.value,loading:q(V),"action-layout":"inline","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!1},"expandable-rows":!1,filtering:!1,rowSize:"sm",striped:!1,dropDownPerPageOptions:[5,10,25,50],"multi-select":!1,"radio-select":!1,"break-extra-columns":!1,"search-in-backend":!0,showEdit:!0,showDelete:!1,actions:Q,onView:Y,onEdit:z,onDelete:I,onSearch:K,onChangePage:H,"onUpdate:perPage":J,onRefresh:q(y)},{"left-buttons":f(()=>[D(M,{class:"btn btn-success btn-sm",onClick:S,style:{"font-size":"1.2rem"}},{icon:f(()=>[D(r,{icon:["fas","plus"]})]),default:f(()=>[t[1]||(t[1]=$(" New Project "))]),_:1})]),"column-bid_amount":f(({row:a})=>[p("div",it,C(_(a.bid_amount)),1)]),"column-total_expense_amount":f(({row:a})=>[p("div",lt,C(_(a.total_expense_amount)),1)]),"column-total_contributed_amount":f(({row:a})=>[p("div",ct,C(_(a.total_contributed_amount)),1)]),"column-deficit":f(({row:a})=>[p("div",ut,C(_(a.deficit)),1)]),_:1},8,["data","loading","onRefresh"])])])}}};export{de as default};
