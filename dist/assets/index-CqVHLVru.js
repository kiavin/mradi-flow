import{al as G,a4 as b,a8 as v,a3 as D,a6 as S,as as k,at as ae,au as te,ap as oe,ac as se,av as ne,af as p,ag as U,ar as le,aw as re,ai as O,am as ie,a5 as y,a7 as R,ao as ce,a9 as V,aa as ue,ah as q,ax as E}from"./index-JmUMqtoz.js";import{_ as x}from"./form-JHkGiTMu.js";import{A as de}from"./AssignmentManager-DMSLx8RO.js";import"./BaseInput-Bqa6yMEv.js";/* empty css                                                                  */import"./BaseButton-C1eW0EPa.js";import"./BaseLabel-BrMg7tDt.js";const me={key:0,class:"me-2"},ge={key:1},fe={key:2,class:"ms-2"},F={__name:"BaseButton",props:{as:{type:String,default:"button"},href:{type:String,default:"#"},variant:{type:String,default:"primary"},size:{type:String,default:"md"},rounded:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},type:{type:String,default:"button"},icon:{type:String,default:null},iconPosition:{type:String,default:"left"},disabled:{type:Boolean,default:!1},customClass:{type:String,default:""}},setup(o){const f={sm:"btn-sm",md:"",lg:"btn-lg"};return(i,l)=>(b(),G(te(o.as==="link"?"a":"button"),{href:o.as==="link"?o.href:null,type:o.as==="link"?null:o.type,disabled:o.as==="link"?null:o.disabled,class:ae(["btn",`btn-${o.variant}`,f[o.size],{rounded:o.rounded,"rounded-pill":o.pill,disabled:o.as==="link"&&o.disabled},o.customClass])},{default:v(()=>[o.iconPosition==="left"&&i.$slots.icon?(b(),D("span",me,[k(i.$slots,"icon")])):S("",!0),i.$slots.default?(b(),D("span",ge,[k(i.$slots,"default")])):S("",!0),o.iconPosition==="right"&&i.$slots.icon?(b(),D("span",fe,[k(i.$slots,"icon")])):S("",!0)]),_:3},8,["href","type","disabled","class"]))}},pe={class:"card p-3"},he={class:"row d-flex justify-content-between align-items-center mb-3"},ye={class:"col-auto mb-4"},ve={class:"p-3 bg-light"},be="/v1/iam/rbac/roles",ke={__name:"index",setup(o){const{proxy:f}=oe(),i=se(),l=ne(),{data:c,request:w,refresh:P,isLoading:z,error:M}=p(be,{method:"GET",options:{},autoFetch:!1}),d=U({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:20,totalCount:0,totalPages:0,paginationLinks:{}}}),_=[{key:"name",label:"Name"},{key:"description",label:"Description"}];le(c,()=>{C()});const C=()=>{var e;if((e=c.value)!=null&&e.dataPayload){const a=c.value.dataPayload.data;let t=[];typeof a=="object"&&!Array.isArray(a)?t=Object.values(a):Array.isArray(a)&&(t=a),d.value={data:t,paginationData:{countOnPage:c.value.dataPayload.countOnPage||0,currentPage:c.value.dataPayload.currentPage||1,perPage:c.value.dataPayload.perPage||d.value.paginationData.perPage,totalCount:c.value.dataPayload.totalCount||0,totalPages:c.value.dataPayload.totalPages||0,paginationLinks:c.value.dataPayload.paginationLinks||{}}},console.log("Updated tableData:",JSON.parse(JSON.stringify(d.value)))}},j=async e=>{var r,g;const a=e.name;if(l.toggleModalUsage(!0),await E(),!l.useModal){i.push({name:"iam/roles/view",params:{id:a}});return}const t=`/v1/iam/rbac/role/${a}`,{data:s,request:n,isLoading:u,error:m}=p(t,{method:"GET",options:{},autoFetch:!0});await n(),l.openModal(x,{formData:((g=(r=s.value)==null?void 0:r.dataPayload)==null?void 0:g.data)||{},error:m,isLoading:u,readonly:!0,hideSubmit:!0},"View Role")},h=U({}),Y=async e=>{var r,g;const a=e.name;if(h.value={},l.toggleModalUsage(!0),await E(),!l.useModal){i.push({name:"iam/roles/update",params:{id:a}});return}const t=`/v1/iam/rbac/role/${a}`,{data:s,request:n,isLoading:u}=p(t,{method:"GET",options:{},autoFetch:!0});await n();const m=async B=>{var L,N;const{data:T,request:ee,error:$}=p(t,{method:"PUT"});if(await ee(B),$.value){console.log("Error",$.value),h.value=$.value;return}l.closeModal(),f.$showAlert({title:"Success",icon:"success",text:((N=(L=T.value)==null?void 0:L.alertifyPayload)==null?void 0:N.message)??"Role Updated successfully",showConfirmButton:!1,showCancelButton:!1,draggable:!0,timer:2e3,timerProgressBar:!0}),P()};l.openModal(x,{formData:((g=(r=s.value)==null?void 0:r.dataPayload)==null?void 0:g.data)||{},error:h,isLoading:u,readonly:!1,hideSubmit:!1,onSubmit:m},"Edit Roles")},A=async()=>{if(h.value={},l.toggleModalUsage(!0),await E(),!l.useModal){i.push({name:"iam/rbac/roles/create"});return}const e=async a=>{var m,r;const t="/v1/iam/rbac/role",{data:s,request:n,error:u}=p(t,{method:"POST"});if(await n(a),u.value){console.log("Error",u.value),h.value=u.value;return}l.closeModal(),f.$showAlert({title:"Success",icon:"success",text:((r=(m=s.value)==null?void 0:m.alertifyPayload)==null?void 0:r.message)??"Role Created successfully",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),P()};l.openModal(x,{formData:{},error:h,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:e},"Create Role")},J=async e=>{var m,r;const a=e.name,t=e.is_deleted,s=t?"Restore":"Delete",n=t?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await f.$showAlert({title:"Are you sure?",text:n,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${s} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:g,request:B,isLoading:T}=p(`/v1/iam/rbac/role/${a}`,{method:"DELETE"});await B(),g.value&&await f.$showAlert({title:`${s}d!`,text:((r=(m=g.value)==null?void 0:m.toastPayload)==null?void 0:r.toastMessage)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",M),await f.$showAlert({title:"Error!",text:`Error deleting record: ${M.value}`,icon:"error",showCancelButton:!1})}finally{await P()}else console.log("Deletion cancelled")},I=e=>{w(null,{page:d.value.paginationData.currentPage,"per-page":d.value.paginationData.perPage,_search:e})},H=async e=>{await w(null,{page:e,"per-page":d.value.paginationData.perPage}),C(),console.log("Page changed to: ",c.value)},K=async e=>{d.value.paginationData.perPage=e,await w(null,{page:d.value.paginationData.currentPage,"per-page":e}),C()};re(()=>{w().then(()=>{C()})});const Q=async(e,a)=>{const{request:t,error:s,isLoading:n}=p(e,{method:"PUT"});return await t(a),s.value?{error:s.value.message,isLoading:n.value}:{success:!0,isLoading:n.value,shouldRefresh:!0}},W=[{key:"description",onSave:async(e,a)=>{const t={name:a.name,description:e,...a.ruleName&&{ruleName:a.ruleName}},s=`/v1/iam/rbac/role/${a.name}`,n=await Q(s,t);return P(),n}}],X=e=>{l.openModal(de,{entity:e,config:{title:"permissions",availableTitle:"Roles & Permissions",assignedTitle:"Roles & Permissions",keyField:"name",displayField:"name",getAllEndpoint:`/v1/iam/rbac/role/${e.name}`,getAssignedEndpoint:`/v1/iam/rbac/role/${e.name}`,assignEndpoint:`/v1/iam/rbac/role/assign/${e.name}`,removeEndpoint:`/v1/iam/rbac/role/remove/${e.name}`}},`Manage Permissions for {${e.name}} Role`,"xl",!1,{centered:!1,scrollable:!0})},Z=[{key:"manage-role",label:"Manage",icon:["fas","shield-halved"],callback:e=>X(e),show:!0,colorClass:"text-secondary "}];return(e,a)=>{const t=O("font-awesome-icon"),s=O("OmniGridView"),n=ie("tooltip");return b(),D("div",pe,[y("div",he,[a[2]||(a[2]=y("div",{class:"col-auto"},[y("h1",{class:"h4 mt-2"},"List of Roles")],-1)),y("div",ye,[ce((b(),G(F,{type:"submit",customClass:"btn btn-primary",onClick:A},{default:v(()=>a[0]||(a[0]=[V(" New Role ")])),_:1})),[[n,"Add New Role","left"]])]),R(s,{columns:_,"editable-columns":W,data:d.value,loading:q(z),dropDownPerPageOptions:[10,25,50],actions:Z,"action-layout":"inline",title:"Role","pagination-config":{show:!0,variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!0,showCreateButton:!0},"expandable-rows":!1,filtering:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!0,"search-in-backend":!0,onView:j,onEdit:Y,onDelete:J,onSearch:I,onChangePage:H,"onUpdate:perPage":K,onRefresh:q(w)},{"left-buttons":v(()=>[R(F,{class:"btn btn-success btn-sm",onClick:A,style:{"font-size":"1.2rem"}},{icon:v(()=>[R(t,{icon:["fas","plus"]})]),default:v(()=>[a[1]||(a[1]=V(" New Role "))]),_:1})]),expanded:v(({row:u})=>[y("div",ve,[y("pre",null,"              "+ue(u)+`
             `,1)])]),_:1},8,["data","loading","onRefresh"])])])}}};export{ke as default};
