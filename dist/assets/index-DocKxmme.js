import{ap as I,ac as H,av as J,af as g,ag as w,ar as K,aw as Q,ai as A,a3 as W,a4 as X,a5 as P,a7 as y,a8 as b,a9 as F,ah as L,ax as B}from"./index-D2aSRXYT.js";import{_ as $}from"./BaseButton-BJlAQNhW.js";import{_ as O}from"./form-DuSbie_F.js";import{b as E,f as k}from"./selectOptionFetcher-VMVmQjxm.js";/* empty css                                                                  */import"./BaseLabel-m47llh8T.js";import"./SelectComponent-Dd3exPW7.js";const Z={class:"card p-3"},ee={class:"row d-flex justify-content-between align-items-center mb-3"},ae={class:"col-auto mb-4"},te="/v1/project/project-financiers",de={__name:"index",setup(oe){const{proxy:j}=I(),_=H(),o=J(),{data:n,request:m,refresh:C,isLoading:U,error:M}=g(te,{method:"GET",options:{},autoFetch:!1}),l=w({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:20,totalCount:0,totalPages:0,paginationLinks:{}}}),V=[{key:"project_name",label:"Project"},{key:"financier_name",label:"Financier"},{key:"amount",label:"Amount"}],u=w([]),d=w([]);K(n,()=>{v()});const v=()=>{var a;if((a=n.value)!=null&&a.dataPayload){const e=n.value.dataPayload.data;let t=[];typeof e=="object"&&!Array.isArray(e)?t=Object.values(e):Array.isArray(e)&&(t=e),l.value={data:t,paginationData:{countOnPage:n.value.dataPayload.countOnPage||0,currentPage:n.value.dataPayload.currentPage||1,perPage:n.value.dataPayload.perPage||l.value.paginationData.perPage,totalCount:n.value.dataPayload.totalCount||0,totalPages:n.value.dataPayload.totalPages||0,paginationLinks:n.value.dataPayload.paginationLinks||{}}}}},q=async a=>{var c,i;const e=a.id;if(o.toggleModalUsage(!0),await B(),!o.useModal){_.push({name:"project/projectfinancier/view",params:{id:e}});return}const t=`/v1/project/project-financier/${e}`,{data:r,request:s,isLoading:h,error:f}=g(t,{method:"GET",options:{},autoFetch:!0});await s(),d.value=await E(),u.value=await k(),o.openModal(O,{formData:((i=(c=r.value)==null?void 0:c.dataPayload)==null?void 0:i.data)||{},error:f,projectOptions:d.value,financierOptions:u.value,isLoading:h,readonly:!0,hideSubmit:!0},"View ProjectFinancier")},p=w({}),N=async a=>{var c,i;const e=a.id;if(p.value={},o.toggleModalUsage(!0),await B(),!o.useModal){_.push({name:"project/projectfinancier/update",params:{id:e}});return}const t=`/v1/project/project-financier/${e}`,{data:r,request:s,isLoading:h}=g(t,{method:"GET",options:{},autoFetch:!0,autoAlert:!0});await s(),d.value=await E(),u.value=await k();const f=async D=>{const{request:T,error:x}=g(t,{method:"PUT"});if(await T(D),x.value){console.log("Error",x.value),p.value=x.value;return}o.closeModal(),C()};o.openModal(O,{formData:((i=(c=r.value)==null?void 0:c.dataPayload)==null?void 0:i.data)||{},error:p,projectOptions:d.value,financierOptions:u.value,isLoading:h,context:"Edit",readonly:!1,hideSubmit:!1,onSubmit:f},"Edit ProjectFinancier")},S=async()=>{if(p.value={},o.toggleModalUsage(!0),await B(),!o.useModal){_.push({name:"project/projectfinancier/create"});return}d.value=await E(),u.value=await k();const a=async e=>{const t="/v1/project/project-financier",{request:r,error:s}=g(t,{method:"POST",autoAlert:!0});if(await r(e),s.value){console.log("Error",s.value),p.value=s.value;return}o.closeModal(),C()};o.openModal(O,{formData:{},error:p,projectOptions:d.value,financierOptions:u.value,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:a},"Create ProjectFinancier")},R=async a=>{var f,c;const e=a.id,t=a.is_deleted,r=t?"Restore":"Delete",s=t?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await j.$showAlert({title:"Are you sure?",text:s,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${r} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:i,request:D,isLoading:T}=g(`/v1/project/project-financier/${e}`,{method:"DELETE"});await D(),i.value&&await j.$showAlert({title:`${r}d!`,text:((c=(f=i.value)==null?void 0:f.alertifyPayload)==null?void 0:c.message)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",M),await j.$showAlert({title:"Error!",text:`Error deleting record: ${M.value}`,icon:"error",showCancelButton:!1})}finally{await C()}else console.log("Deletion cancelled")},G=a=>{m(null,{page:l.value.paginationData.currentPage,"per-page":l.value.paginationData.perPage,q:a})},Y=async a=>{await m(null,{page:a,"per-page":l.value.paginationData.perPage}),v(),console.log("Page changed to: ",n.value)},z=async a=>{l.value.paginationData.perPage=a,await m(null,{page:l.value.paginationData.currentPage,"per-page":a}),v()};return Q(()=>{m().then(()=>{v()})}),(a,e)=>{const t=A("font-awesome-icon"),r=A("OmniGridView");return X(),W("div",Z,[P("div",ee,[e[2]||(e[2]=P("div",{class:"col-auto"},[P("h1",{class:"h4 mt-2"},"List of ProjectFinancier")],-1)),P("div",ae,[y($,{type:"submit",customClass:"btn btn-primary",onClick:S},{default:b(()=>e[0]||(e[0]=[F(" New ProjectFinancier ")])),_:1})]),y(r,{columns:V,data:l.value,loading:L(U),"action-layout":"inline","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!0,showCreateButton:!1},"expandable-rows":!1,filtering:!1,rowSize:"sm",striped:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!1,"search-in-backend":!0,onView:q,onEdit:N,onDelete:R,onSearch:G,onChangePage:Y,"onUpdate:perPage":z,onRefresh:L(m)},{"left-buttons":b(()=>[y($,{class:"btn btn-success btn-sm",onClick:S,style:{"font-size":"1.2rem"}},{icon:b(()=>[y(t,{icon:["fas","plus"]})]),default:b(()=>[e[1]||(e[1]=F(" New ProjectFinancier "))]),_:1})]),_:1},8,["data","loading","onRefresh"])])])}}};export{de as default};
