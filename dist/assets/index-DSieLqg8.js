import{ap as K,ac as Q,av as W,af as u,ag as E,ar as X,aw as Z,ai as S,a3 as aa,a4 as ea,a5 as w,a7 as P,a8 as b,a9 as F,ah as L,ax as M}from"./index-DbV2-pUC.js";import{_ as $}from"./BaseButton-YAZ4b25V.js";import{_ as q}from"./form-5DnZhQ3s.js";/* empty css                                                                  */import"./SelectComponent-DgvFSSSE.js";const ta={class:"card p-3"},oa={class:"row d-flex justify-content-between align-items-center mb-3"},na={class:"col-auto mb-4"},sa="/v1/project/projects",N="/v1/project/financiers",pa={__name:"index",setup(ra){const{proxy:_}=K(),D=Q(),r=W(),{data:o,request:m,refresh:C,isLoading:O,error:A}=u(sa,{method:"GET",options:{},autoFetch:!1}),l=E({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:20,totalCount:0,totalPages:0,paginationLinks:{}}}),U=[{key:"name",label:"Name"},{key:"bid_amount",label:"Bid Amount"},{key:"total_financiers",label:"Total Financiers"},{key:"total_expenses",label:"Total Expenses"}],g=E([]);X(o,()=>{v()});const v=()=>{var a;if((a=o.value)!=null&&a.dataPayload){const e=o.value.dataPayload.data;let t=[];typeof e=="object"&&!Array.isArray(e)?t=Object.values(e):Array.isArray(e)&&(t=e),l.value={data:t,paginationData:{countOnPage:o.value.dataPayload.countOnPage||0,currentPage:o.value.dataPayload.currentPage||1,perPage:o.value.dataPayload.perPage||l.value.paginationData.perPage,totalCount:o.value.dataPayload.totalCount||0,totalPages:o.value.dataPayload.totalPages||0,paginationLinks:o.value.dataPayload.paginationLinks||{}}}}},R=async a=>{const e=a.id;D.push({name:"projectDashboard",params:{id:e}})},d=E({}),V=async a=>{var h,j,T,k;const e=a.id;if(d.value={},r.toggleModalUsage(!0),await M(),!r.useModal){D.push({name:"project/project/update",params:{id:e}});return}const t=`/v1/project/project/${e}`,{data:n,request:p,isLoading:c}=u(t,{method:"GET",options:{},autoFetch:!0,autoAlert:!0});await p();const{data:i,request:f}=u(N,{method:"GET",autoFetch:!0,autoAlert:!1});await f(),(j=(h=i.value)==null?void 0:h.dataPayload)!=null&&j.data?g.value=i.value.dataPayload.data.map(y=>({value:y.id,label:y.name})):console.warn("Could not load financiers:",i.value);const s=async y=>{const{request:J,error:x}=u(t,{method:"PUT"});if(await J(y),x.value){console.log("Error",x.value),d.value=x.value;return}r.closeModal(),C()};r.openModal(q,{formData:((k=(T=n.value)==null?void 0:T.dataPayload)==null?void 0:k.data)||{},Financiers:g.value,error:d,isLoading:c,readonly:!1,hideSubmit:!1,onSubmit:s},"Edit Project")},B=async()=>{var n,p;if(d.value={},r.toggleModalUsage(!0),await M(),!r.useModal){D.push({name:"project/project/create"});return}const{data:a,request:e}=u(N,{method:"GET",autoFetch:!0,autoAlert:!1});await e(),Array.isArray((p=(n=a.value)==null?void 0:n.dataPayload)==null?void 0:p.data)?g.value=a.value.dataPayload.data.map(c=>({value:c.id,label:c.name})):console.warn("Could not load financiers:",a.value);const t=async c=>{const i="/v1/project/project",{request:f,error:s}=u(i,{method:"POST",autoAlert:!0});if(await f(c),s.value){console.log("Error",s.value),d.value=s.value;return}r.closeModal(),C()};r.openModal(q,{formData:{},error:d,Financiers:g.value,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:t},"Create Project")},G=async a=>{var i,f;const e=a.id,t=a.is_deleted,n=t?"Restore":"Delete",p=t?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await _.$showAlert({title:"Are you sure?",text:p,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${n} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:s,request:h,isLoading:j}=u(`/v1/project/project/${e}`,{method:"DELETE"});await h(),s.value&&await _.$showAlert({title:`${n}d!`,text:((f=(i=s.value)==null?void 0:i.alertifyPayload)==null?void 0:f.message)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",A),await _.$showAlert({title:"Error!",text:`Error deleting record: ${A.value}`,icon:"error",showCancelButton:!1})}finally{await C()}else console.log("Deletion cancelled")},Y=a=>{m(null,{page:l.value.paginationData.currentPage,"per-page":l.value.paginationData.perPage,q:a})},z=async a=>{await m(null,{page:a,"per-page":l.value.paginationData.perPage}),v()},I=async a=>{l.value.paginationData.perPage=a,await m(null,{page:l.value.paginationData.currentPage,"per-page":a}),v()},H=[];return Z(()=>{m().then(()=>{v()})}),(a,e)=>{const t=S("font-awesome-icon"),n=S("OmniGridView");return ea(),aa("div",ta,[w("div",oa,[e[2]||(e[2]=w("div",{class:"col-auto"},[w("h1",{class:"h4 mt-2"},"List of Project")],-1)),w("div",na,[P($,{type:"submit",customClass:"btn btn-primary",onClick:B},{default:b(()=>e[0]||(e[0]=[F(" New Project ")])),_:1})]),P(n,{columns:U,data:l.value,loading:L(O),"action-layout":"inline","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!1},"expandable-rows":!1,filtering:!1,rowSize:"sm",striped:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!1,"search-in-backend":!0,showEdit:!1,showDelete:!1,actions:H,onView:R,onEdit:V,onDelete:G,onSearch:Y,onChangePage:z,"onUpdate:perPage":I,onRefresh:L(m)},{"left-buttons":b(()=>[P($,{class:"btn btn-success btn-sm",onClick:B,style:{"font-size":"1.2rem"}},{icon:b(()=>[P(t,{icon:["fas","plus"]})]),default:b(()=>[e[1]||(e[1]=F(" New Project "))]),_:1})]),_:1},8,["data","loading","onRefresh"])])])}}};export{pa as default};
