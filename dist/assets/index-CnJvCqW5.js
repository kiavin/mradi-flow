import{useRouter as te}from"./vue-router-Ds9KUoJm.js";import{k as G,e as b,D as v,a as D,j as S,l as k,q as ae,L as oe,g as se,r as U,w as ne,o as re,aj as O,al as ie,i as y,O as R,U as le,M as V,x as ce,C as q,n as E}from"./@vue-D5jJVPgi.js";import{c as ue,b as f}from"./index-BIgdAOk1.js";import{_ as x}from"./form-BaA2mJp8.js";import{A as de}from"./AssignmentManager-BAOPPtDL.js";import"./pinia-BWRdMQcg.js";import"./bootstrap-r_TW8pGT.js";import"./@popperjs-BEKk9TLb.js";import"./bootstrap-vue-next-CI7J1iGq.js";import"./izitoast-CqdWWGAA.js";import"./sweetalert2-89IKscqO.js";import"./@fortawesome-BMRTUbaC.js";import"./jspdf-BHjgPkY0.js";import"./@babel-BgpAVVkQ.js";import"./fflate-DE92GPtl.js";import"./@vueuse-BFKO5FPz.js";import"./xlsx-VQGdcWwX.js";import"./jspdf-autotable-DwCSpOYb.js";import"./@tsparticles-RHRfPQQI.js";import"./pinia-plugin-persistedstate-BuM6D3kL.js";import"./destr-BPvN1X9m.js";import"./deep-pick-omit-CegYQlcN.js";import"./lodash-CW-aI5JM.js";import"./crypto-js-C9xuVu9R.js";import"./axios-xsH4HHeE.js";import"./qs-Dop67Io4.js";import"./side-channel-DfNisRws.js";import"./es-errors-CxTyLFAO.js";import"./object-inspect-CwG9orBb.js";import"./side-channel-list-CVgrowBt.js";import"./side-channel-map-Czb7NFry.js";import"./get-intrinsic-BpLglCTt.js";import"./es-object-atoms-BR76m4z7.js";import"./math-intrinsics-DP1tGiab.js";import"./gopd-C1lCZ5Qs.js";import"./es-define-property-D_7cP-M3.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-Cd0SCNDH.js";import"./dunder-proto-DSwuxXkl.js";import"./call-bind-apply-helpers-VtLnLD2e.js";import"./function-bind-CHqF18-c.js";import"./hasown-DwiY0sux.js";import"./call-bound-BuGV4nFB.js";import"./side-channel-weakmap-DmcBNuf_.js";import"./smooth-scrollbar-CSiRJ_Pw.js";import"./core-js-BA3D9nVJ.js";import"./@vueform-b-21xuRD.js";import"./vue3-circle-progress-DRe7pzrA.js";import"./vue-Aiaqh0QQ.js";import"./vue3-apexcharts-CSHbnzTQ.js";import"./apexcharts-AYwITVQt.js";import"./BaseInput-BvsC8VxS.js";/* empty css                                                                  */import"./BaseButton-WTmgFy-8.js";import"./BaseLabel-ahH6on5a.js";/* empty css                                                                  */const me={key:0,class:"me-2"},pe={key:1},ge={key:2,class:"ms-2"},F={__name:"BaseButton",props:{as:{type:String,default:"button"},href:{type:String,default:"#"},variant:{type:String,default:"primary"},size:{type:String,default:"md"},rounded:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},type:{type:String,default:"button"},icon:{type:String,default:null},iconPosition:{type:String,default:"left"},disabled:{type:Boolean,default:!1},customClass:{type:String,default:""}},setup(o){const g={sm:"btn-sm",md:"",lg:"btn-lg"};return(l,r)=>(b(),G(oe(o.as==="link"?"a":"button"),{href:o.as==="link"?o.href:null,type:o.as==="link"?null:o.type,disabled:o.as==="link"?null:o.disabled,class:ae(["btn",`btn-${o.variant}`,g[o.size],{rounded:o.rounded,"rounded-pill":o.pill,disabled:o.as==="link"&&o.disabled},o.customClass])},{default:v(()=>[o.iconPosition==="left"&&l.$slots.icon?(b(),D("span",me,[k(l.$slots,"icon")])):S("",!0),l.$slots.default?(b(),D("span",pe,[k(l.$slots,"default")])):S("",!0),o.iconPosition==="right"&&l.$slots.icon?(b(),D("span",ge,[k(l.$slots,"icon")])):S("",!0)]),_:3},8,["href","type","disabled","class"]))}},fe={class:"card p-3"},he={class:"row d-flex justify-content-between align-items-center mb-3"},ye={class:"col-auto mb-4"},ve={class:"p-3 bg-light"},be="/v1/iam/rbac/roles",Ct={__name:"index",setup(o){const{proxy:g}=se(),l=te(),r=ue(),{data:c,request:w,refresh:P,isLoading:j,error:M}=f(be,{method:"GET",options:{},autoFetch:!1}),d=U({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:20,totalCount:0,totalPages:0,paginationLinks:{}}}),z=[{key:"name",label:"Name"},{key:"description",label:"Description"}];ne(c,()=>{C()});const C=()=>{var e;if((e=c.value)!=null&&e.dataPayload){const t=c.value.dataPayload.data;let a=[];typeof t=="object"&&!Array.isArray(t)?a=Object.values(t):Array.isArray(t)&&(a=t),d.value={data:a,paginationData:{countOnPage:c.value.dataPayload.countOnPage||0,currentPage:c.value.dataPayload.currentPage||1,perPage:c.value.dataPayload.perPage||d.value.paginationData.perPage,totalCount:c.value.dataPayload.totalCount||0,totalPages:c.value.dataPayload.totalPages||0,paginationLinks:c.value.dataPayload.paginationLinks||{}}},console.log("Updated tableData:",JSON.parse(JSON.stringify(d.value)))}},_=async e=>{var i,p;const t=e.name;if(r.toggleModalUsage(!0),await E(),!r.useModal){l.push({name:"iam/roles/view",params:{id:t}});return}const a=`/v1/iam/rbac/role/${t}`,{data:s,request:n,isLoading:u,error:m}=f(a,{method:"GET",options:{},autoFetch:!0});await n(),r.openModal(x,{formData:((p=(i=s.value)==null?void 0:i.dataPayload)==null?void 0:p.data)||{},error:m,isLoading:u,readonly:!0,hideSubmit:!0},"View Role")},h=U({}),Y=async e=>{var i,p;const t=e.name;if(h.value={},r.toggleModalUsage(!0),await E(),!r.useModal){l.push({name:"iam/roles/update",params:{id:t}});return}const a=`/v1/iam/rbac/role/${t}`,{data:s,request:n,isLoading:u}=f(a,{method:"GET",options:{},autoFetch:!0});await n();const m=async B=>{var T,N;const{data:L,request:ee,error:$}=f(a,{method:"PUT"});if(await ee(B),$.value){console.log("Error",$.value),h.value=$.value;return}r.closeModal(),g.$showAlert({title:"Success",icon:"success",text:((N=(T=L.value)==null?void 0:T.alertifyPayload)==null?void 0:N.message)??"Role Updated successfully",showConfirmButton:!1,showCancelButton:!1,draggable:!0,timer:2e3,timerProgressBar:!0}),P()};r.openModal(x,{formData:((p=(i=s.value)==null?void 0:i.dataPayload)==null?void 0:p.data)||{},error:h,isLoading:u,readonly:!1,hideSubmit:!1,onSubmit:m},"Edit Roles")},A=async()=>{if(h.value={},r.toggleModalUsage(!0),await E(),!r.useModal){l.push({name:"iam/rbac/roles/create"});return}const e=async t=>{var m,i;const a="/v1/iam/rbac/role",{data:s,request:n,error:u}=f(a,{method:"POST"});if(await n(t),u.value){console.log("Error",u.value),h.value=u.value;return}r.closeModal(),g.$showAlert({title:"Success",icon:"success",text:((i=(m=s.value)==null?void 0:m.alertifyPayload)==null?void 0:i.message)??"Role Created successfully",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),P()};r.openModal(x,{formData:{},error:h,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:e},"Create Role")},J=async e=>{var m,i;const t=e.name,a=e.is_deleted,s=a?"Restore":"Delete",n=a?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await g.$showAlert({title:"Are you sure?",text:n,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${s} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:p,request:B,isLoading:L}=f(`/v1/iam/rbac/role/${t}`,{method:"DELETE"});await B(),p.value&&await g.$showAlert({title:`${s}d!`,text:((i=(m=p.value)==null?void 0:m.toastPayload)==null?void 0:i.toastMessage)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",M),await g.$showAlert({title:"Error!",text:`Error deleting record: ${M.value}`,icon:"error",showCancelButton:!1})}finally{await P()}else console.log("Deletion cancelled")},I=e=>{w(null,{page:d.value.paginationData.currentPage,"per-page":d.value.paginationData.perPage,_search:e})},H=async e=>{await w(null,{page:e,"per-page":d.value.paginationData.perPage}),C(),console.log("Page changed to: ",c.value)},K=async e=>{d.value.paginationData.perPage=e,await w(null,{page:d.value.paginationData.currentPage,"per-page":e}),C()};re(()=>{w().then(()=>{C()})});const Q=async(e,t)=>{const{request:a,error:s,isLoading:n}=f(e,{method:"PUT"});return await a(t),s.value?{error:s.value.message,isLoading:n.value}:{success:!0,isLoading:n.value,shouldRefresh:!0}},W=[{key:"description",onSave:async(e,t)=>{const a={name:t.name,description:e,...t.ruleName&&{ruleName:t.ruleName}},s=`/v1/iam/rbac/role/${t.name}`,n=await Q(s,a);return P(),n}}],X=e=>{r.openModal(de,{entity:e,config:{title:"permissions",availableTitle:"Roles & Permissions",assignedTitle:"Roles & Permissions",keyField:"name",displayField:"name",getAllEndpoint:`/v1/iam/rbac/role/${e.name}`,getAssignedEndpoint:`/v1/iam/rbac/role/${e.name}`,assignEndpoint:`/v1/iam/rbac/role/assign/${e.name}`,removeEndpoint:`/v1/iam/rbac/role/remove/${e.name}`}},`Manage Permissions for {${e.name}} Role`,"xl",!1,{centered:!1,scrollable:!0})},Z=[{key:"manage-role",label:"Manage",icon:["fas","shield-halved"],callback:e=>X(e),show:!0,colorClass:"text-secondary "}];return(e,t)=>{const a=O("font-awesome-icon"),s=O("OmniGridView"),n=ie("tooltip");return b(),D("div",fe,[y("div",he,[t[2]||(t[2]=y("div",{class:"col-auto"},[y("h1",{class:"h4 mt-2"},"List of Roles")],-1)),y("div",ye,[le((b(),G(F,{type:"submit",customClass:"btn btn-primary",onClick:A},{default:v(()=>t[0]||(t[0]=[V(" New Role ")])),_:1})),[[n,"Add New Role","left"]])]),R(s,{columns:z,"editable-columns":W,data:d.value,loading:q(j),dropDownPerPageOptions:[10,25,50],actions:Z,"action-layout":"inline",title:"Role","pagination-config":{show:!0,variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!0,showCreateButton:!0},"expandable-rows":!1,filtering:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!0,"search-in-backend":!0,onView:_,onEdit:Y,onDelete:J,onSearch:I,onChangePage:H,"onUpdate:perPage":K,onRefresh:q(w)},{"left-buttons":v(()=>[R(F,{class:"btn btn-success btn-sm",onClick:A,style:{"font-size":"1.2rem"}},{icon:v(()=>[R(a,{icon:["fas","plus"]})]),default:v(()=>[t[1]||(t[1]=V(" New Role "))]),_:1})]),expanded:v(({row:u})=>[y("div",ve,[y("pre",null,"              "+ce(u)+`
             `,1)])]),_:1},8,["data","loading","onRefresh"])])])}}};export{Ct as default};
