import{r as _,o as te,b as oe,c as m,al as ie,a,e as l,i as s,j as v,x as p,U as y,O as r,C as u,ak as I,F as C,u as L,q as M,M as z}from"./@vue-D5jJVPgi.js";import{F as g}from"./@fortawesome-BMRTUbaC.js";import{_ as ae,u as le,c as ne,b as Q}from"./index-CtPaYIeo.js";const ce={class:"container-fluid p-3"},de={key:0,class:"d-flex flex-column gap-3"},re={class:"card shadow-sm"},ue={class:"card-header bg-light"},ge={class:"mb-0"},ve={class:"card-body p-2"},pe={class:"input-group mb-3"},he={class:"input-group-text"},fe=["placeholder"],be={class:"list-group overflow-auto",style:{"max-height":"40vh"}},me={key:0,class:"list-group-item list-group-item-action"},ye=["onClick"],_e={key:0,class:"text-muted"},ke={key:0,class:"badge bg-primary rounded-pill"},we={class:"d-grid gap-2 d-md-flex justify-content-center"},xe=["disabled"],Ae=["disabled"],Ce={class:"card shadow-sm"},Fe={class:"card-header bg-light"},Se={class:"mb-0"},Te={class:"card-body p-2"},je={class:"input-group mb-3"},Ee={class:"input-group-text"},Ie=["placeholder"],Le={class:"list-group overflow-auto",style:{"max-height":"40vh"}},Me={key:0,class:"list-group-item list-group-item-action"},ze=["onClick"],Ne={key:0,class:"text-muted"},Ve={key:0,class:"badge bg-primary rounded-pill"},Oe={class:"d-grid gap-2 d-md-flex justify-content-center"},De=["disabled"],Pe=["disabled"],Ue={key:1,class:"row"},qe={class:"col-lg-5 col-xl-5"},Be={class:"card shadow-sm h-100"},Re={class:"card-header bg-light d-flex align-items-center justify-content-center py-3 border-top rounded-top"},$e={class:"mb-0"},We={class:"card-body d-flex flex-column p-0"},Ge={class:"input-group mb-3 px-3 pt-3"},He={class:"input-group-text"},Je=["placeholder"],Ke={class:"list-group overflow-auto",style:{"max-height":"60vh","min-height":"200px"}},Qe={key:0,class:"list-group-item list-group-item-action"},Xe=["onClick"],Ye={key:0,class:"fw-bold"},Ze={key:0,class:"badge bg-primary rounded-pill"},es={class:"col-lg-2 col-xl-2 d-flex flex-column justify-content-center px-0"},ss={class:"d-grid gap-2 mx-auto",style:{width:"fit-content"}},ts=["disabled"],os=["disabled"],is=["disabled"],as=["disabled"],ls={class:"col-lg-5 col-xl-5"},ns={class:"card shadow-sm h-100"},cs={class:"card-header bg-light d-flex align-items-center justify-content-center py-3 border-top rounded-top"},ds={class:"mb-0"},rs={class:"card-body d-flex flex-column p-0"},us={class:"input-group mb-3 px-3 pt-3"},gs={class:"input-group-text"},vs=["placeholder"],ps={class:"list-group overflow-auto",style:{"max-height":"60vh","min-height":"200px"}},hs={key:0,class:"list-group-item list-group-item-action"},fs=["onClick"],bs={key:0,class:"fw-bold"},ms={key:0,class:"badge bg-primary rounded-pill"},ys={key:0,class:"loading-overlay d-flex align-items-center justify-content-center"},_s={__name:"AssignmentManager",props:{entity:{type:Object,required:!0},config:{type:Object,required:!0,validator:c=>["title","availableTitle","assignedTitle","keyField","displayField","getAllEndpoint","getAssignedEndpoint","assignEndpoint","removeEndpoint"].every(N=>N in c)},isLoading:Boolean,error:Object},emits:["close","refresh"],setup(c,{emit:N}){const X=le(),Y=ne(),n=c,Z=N,k=_([]),h=_([]),f=_([]),w=_(""),x=_(""),P=_(window.innerWidth<768),U=()=>{P.value=window.innerWidth<768};te(()=>{window.addEventListener("resize",U),A()}),oe(()=>{window.removeEventListener("resize",U)});const V=m(()=>{var t,i;if(!k.value.length)return[];const o=((i=(t=k.value[0])==null?void 0:t.items)==null?void 0:i.available)||{};return Object.entries(o).map(([e,d])=>({[n.config.keyField]:e,[n.config.displayField]:e,type:d,description:e}))}),O=m(()=>{var t,i;if(!k.value.length)return[];const o=((i=(t=k.value[0])==null?void 0:t.items)==null?void 0:i.assigned)||{};return Object.entries(o).map(([e,d])=>({[n.config.keyField]:e,[n.config.displayField]:e,type:d,description:e}))}),q=m(()=>{const o=w.value.toLowerCase();return V.value.filter(t=>t[n.config.displayField].toLowerCase().includes(o)||t.description&&t.description.toLowerCase().includes(o))}),B=m(()=>{const o=x.value.toLowerCase();return O.value.filter(t=>t[n.config.displayField].toLowerCase().includes(o)||t.description&&t.description.toLowerCase().includes(o))}),R=m(()=>h.value.length>0),$=m(()=>f.value.length>0),F=m(()=>V.value.length>0),S=m(()=>O.value.length>0),A=async()=>{var o,t;try{const i=typeof n.config.getAllEndpoint=="function"?n.config.getAllEndpoint(n.entity):n.config.getAllEndpoint,{data:e,request:d}=Q(i,{method:"GET"});await d(),k.value=(t=(o=e.value)==null?void 0:o.dataPayload)!=null&&t.data?[e.value.dataPayload.data]:[]}catch(i){console.error("Error fetching data:",i)}},b=(o,t)=>(t==="available"?h.value:f.value).some(e=>e[n.config.keyField]===o[n.config.keyField]),T=(o,t,i=null)=>{i==null||i.stopPropagation(),i==null||i.preventDefault();const e=t==="available"?h:f,d=n.config.keyField,K=e.value.findIndex(se=>se[d]===o[d]);K===-1?e.value.push({...o,[d]:o[d]}):e.value.splice(K,1)},D=_(!1),j=async(o,t)=>{D.value=!0;try{const{data:i,request:e}=Q(o,{method:"POST"});await e(t),X.show(i==null?void 0:i.value),Z("refresh")}catch(i){console.error("Error updating assignments:",i)}finally{D.value=!1}},E=n.config.title,W=async()=>{if(h.value.length===0)return;const o={[E]:h.value.map(t=>t[n.config.keyField])};await j(n.config.assignEndpoint,o),h.value=[],await A()},G=async()=>{const o={[E]:V.value.map(t=>t[n.config.keyField])};await j(n.config.assignEndpoint,o),h.value=[],await A()},H=async()=>{if(f.value.length===0)return;const o={[E]:f.value.map(t=>t[n.config.keyField])};await j(n.config.removeEndpoint,o),f.value=[],await A()},J=async()=>{const o={[E]:O.value.map(t=>t[n.config.keyField])};await j(n.config.removeEndpoint,o),f.value=[],await A()},ee=()=>{h.value=[],f.value=[],Y.closeModal()};return(o,t)=>{const i=ie("tooltip");return l(),a(C,null,[s("div",ce,[P.value?(l(),a("div",de,[s("div",re,[s("div",ue,[s("h5",ge,"Available "+p(c.config.availableTitle),1)]),s("div",ve,[s("div",pe,[s("span",he,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),type:"text",class:"form-control",placeholder:`Search ${c.config.availableTitle.toLowerCase()}...`},null,8,fe),[[I,w.value]])]),s("div",be,[F.value?v("",!0):(l(),a("div",me," No "+p(c.config.availableTitle)+" available. ",1)),(l(!0),a(C,null,L(q.value,e=>(l(),a("div",{key:e[c.config.keyField],class:M(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"available")}]),onClick:d=>T(e,"available",d)},[s("div",null,[e.description?(l(),a("small",_e,p(e.description),1)):v("",!0)]),b(e,"available")?(l(),a("span",ke,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,ye))),128))])])]),s("div",we,[s("button",{onClick:W,class:"btn btn-primary",disabled:!R.value},[r(u(g),{icon:["fas","arrow-down"],class:"me-1"}),t[4]||(t[4]=z(" Assign Selected "))],8,xe),s("button",{onClick:G,class:"btn btn-outline-primary",disabled:!F.value},[r(u(g),{icon:["fas","angles-down"],class:"me-1"}),t[5]||(t[5]=z(" Assign All "))],8,Ae)]),s("div",Ce,[s("div",Fe,[s("h5",Se,"Assigned "+p(c.config.assignedTitle),1)]),s("div",Te,[s("div",je,[s("span",Ee,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),type:"text",class:"form-control",placeholder:`Search assigned ${c.config.assignedTitle.toLowerCase()}...`},null,8,Ie),[[I,x.value]])]),s("div",Le,[S.value?v("",!0):(l(),a("div",Me," No "+p(c.config.assignedTitle)+" assigned. ",1)),(l(!0),a(C,null,L(B.value,e=>(l(),a("div",{key:e[c.config.keyField],class:M(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"assigned")}]),onClick:d=>T(e,"assigned",d)},[s("div",null,[e.description?(l(),a("small",Ne,p(e.description),1)):v("",!0)]),b(e,"assigned")?(l(),a("span",Ve,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,ze))),128))])])]),s("div",Oe,[s("button",{onClick:H,class:"btn btn-danger",disabled:!$.value},[r(u(g),{icon:["fas","arrow-up"],class:"me-1"}),t[6]||(t[6]=z(" Remove Selected "))],8,De),s("button",{onClick:J,class:"btn btn-outline-danger",disabled:!S.value},[r(u(g),{icon:["fas","angles-up"],class:"me-1"}),t[7]||(t[7]=z(" Remove All "))],8,Pe)]),s("div",{class:"d-grid gap-2 d-md-flex justify-content-end mt-2"},[s("button",{onClick:ee,class:"btn btn-outline-secondary"},"Cancel")])])):(l(),a("div",Ue,[s("div",qe,[s("div",Be,[s("div",Re,[s("h5",$e,"Available "+p(c.config.availableTitle),1)]),s("div",We,[s("div",Ge,[s("span",He,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),type:"text",class:"form-control",placeholder:`Search ${c.config.availableTitle.toLowerCase()}...`},null,8,Je),[[I,w.value]])]),s("div",Ke,[F.value?v("",!0):(l(),a("div",Qe," No "+p(c.config.availableTitle)+" available. ",1)),(l(!0),a(C,null,L(q.value,e=>(l(),a("div",{key:e[c.config.keyField],class:M(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"available")}]),onClick:d=>T(e,"available",d)},[s("div",null,[e.description?(l(),a("small",Ye,p(e.description),1)):v("",!0)]),b(e,"available")?(l(),a("span",Ze,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,Xe))),128))])])])]),s("div",es,[s("div",ss,[y((l(),a("button",{onClick:W,class:"btn btn-success p-2",disabled:!R.value},[r(u(g),{icon:["fas","arrow-right"],size:"lg"})],8,ts)),[[i,"Assign Selected","top"]]),y((l(),a("button",{onClick:G,class:"btn btn-outline-success p-2",title:"",disabled:!F.value},[r(u(g),{icon:["fas","angles-right"],size:"lg"})],8,os)),[[i,"Assign All","bottom"]]),t[8]||(t[8]=s("div",{class:"my-2 border-bottom"},null,-1)),y((l(),a("button",{onClick:H,class:"btn btn-danger p-2",disabled:!$.value},[r(u(g),{icon:["fas","arrow-left"],size:"lg"})],8,is)),[[i,"Remove Selected","top"]]),y((l(),a("button",{onClick:J,class:"btn btn-outline-danger p-2",disabled:!S.value},[r(u(g),{icon:["fas","angles-left"],size:"lg"})],8,as)),[[i,"Remove All","bottom"]])])]),s("div",ls,[s("div",ns,[s("div",cs,[s("h5",ds,"Assigned "+p(c.config.assignedTitle),1)]),s("div",rs,[s("div",us,[s("span",gs,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>x.value=e),type:"text",class:"form-control",placeholder:`Search assigned ${c.config.assignedTitle.toLowerCase()}...`},null,8,vs),[[I,x.value]])]),s("div",ps,[S.value?v("",!0):(l(),a("div",hs," No "+p(c.config.assignedTitle)+" assigned. ",1)),(l(!0),a(C,null,L(B.value,e=>(l(),a("div",{key:e[c.config.keyField],class:M(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"assigned")}]),onClick:d=>T(e,"assigned",d)},[s("div",null,[e.description?(l(),a("small",bs,p(e.description),1)):v("",!0)]),b(e,"assigned")?(l(),a("span",ms,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,fs))),128))])])])])]))]),D.value?(l(),a("div",ys,t[9]||(t[9]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):v("",!0)],64)}}},As=ae(_s,[["__scopeId","data-v-ee40f8cd"]]);export{As as A};
