import{aq as J,ac as K,aw as Q,af as m,ag as h,as as W,ax as X,aj as $,a3 as Z,a4 as ee,a5 as P,a7 as x,a8 as b,a9 as U,ah as q,ay as O}from"./index-Dg2vgB2l.js";import{_ as V}from"./BaseButton-CHEyiMBN.js";import{_ as B}from"./form-Dg2P9c4l.js";import{f as k,a as A,b as M}from"./selectOptionFetcher-B5kGJ0-s.js";/* empty css                                                                  */import"./SelectComponent-r8owDwzF.js";const ae={class:"card p-3"},te={class:"row d-flex justify-content-between align-items-center mb-3"},oe={class:"col-auto mb-4"},ne="/v1/project/project-expenses",pe={__name:"index",setup(se){const{proxy:j}=J(),_=K(),o=Q(),{data:n,request:v,refresh:C,isLoading:N,error:S}=m(ne,{method:"GET",options:{},autoFetch:!1}),i=h({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:20,totalCount:0,totalPages:0,paginationLinks:{}}}),u=h([]),d=h([]),p=h([]),R=[{key:"project_name",label:"Project"},{key:"expense_name",label:"Expenses"},{key:"total_amount",label:"Expense Amount"},{key:"contributed_amount",label:"Contributed Amount"}];W(n,()=>{w()});const w=()=>{var a;if((a=n.value)!=null&&a.dataPayload){const e=n.value.dataPayload.data;let t=[];typeof e=="object"&&!Array.isArray(e)?t=Object.values(e):Array.isArray(e)&&(t=e),i.value={data:t,paginationData:{countOnPage:n.value.dataPayload.countOnPage||0,currentPage:n.value.dataPayload.currentPage||1,perPage:n.value.dataPayload.perPage||i.value.paginationData.perPage,totalCount:n.value.dataPayload.totalCount||0,totalPages:n.value.dataPayload.totalPages||0,paginationLinks:n.value.dataPayload.paginationLinks||{}}}}},F=async a=>{var c,l;const e=a.id;if(o.toggleModalUsage(!0),await O(),!o.useModal){_.push({name:"project/projectexpense/view",params:{id:e}});return}const t=`/v1/project/project-expense/${e}`,{data:s,request:r,isLoading:y,error:g}=m(t,{method:"GET",options:{},autoFetch:!0});await r(),u.value=await k(),d.value=await A(),p.value=await M(),o.openModal(B,{formData:((l=(c=s.value)==null?void 0:c.dataPayload)==null?void 0:l.data)||{},error:g,financierOptions:u.value,expenseOptions:d.value,projectOptions:p.value,isLoading:y,readonly:!0,hideSubmit:!0},"View ProjectExpense")},f=h({}),G=async a=>{var c,l;const e=a.id;if(f.value={},o.toggleModalUsage(!0),await O(),!o.useModal){_.push({name:"project/projectexpense/update",params:{id:e}});return}const t=`/v1/project/project-expense/${e}`,{data:s,request:r,isLoading:y}=m(t,{method:"GET",options:{},autoFetch:!0,autoAlert:!0});await r(),u.value=await k(),d.value=await A(),p.value=await M();const g=async D=>{const{request:L,error:E}=m(t,{method:"PUT"});if(await L(D),E.value){console.log("Error",E.value),f.value=E.value;return}o.closeModal(),C()};o.openModal(B,{formData:((l=(c=s.value)==null?void 0:c.dataPayload)==null?void 0:l.data)||{},error:f,financierOptions:u.value,expenseOptions:d.value,projectOptions:p.value,isLoading:y,readonly:!1,hideSubmit:!1,onSubmit:g},"Edit ProjectExpense")},T=async()=>{if(f.value={},o.toggleModalUsage(!0),await O(),!o.useModal){_.push({name:"project/projectexpense/create"});return}const a=async e=>{const t="/v1/project/project-expense",{request:s,error:r}=m(t,{method:"POST",autoAlert:!0});if(await s(e),r.value){console.log("Error",r.value),f.value=r.value;return}u.value=await k(),d.value=await A(),p.value=await M(),o.closeModal(),C()};o.openModal(B,{formData:{},error:f,financierOptions:u.value,expenseOptions:d.value,projectOptions:p.value,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:a},"Create ProjectExpense")},Y=async a=>{var g,c;const e=a.id,t=a.is_deleted,s=t?"Restore":"Delete",r=t?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await j.$showAlert({title:"Are you sure?",text:r,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${s} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:l,request:D,isLoading:L}=m(`/v1/project/project-expense/${e}`,{method:"DELETE"});await D(),l.value&&await j.$showAlert({title:`${s}d!`,text:((c=(g=l.value)==null?void 0:g.alertifyPayload)==null?void 0:c.message)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",S),await j.$showAlert({title:"Error!",text:`Error deleting record: ${S.value}`,icon:"error",showCancelButton:!1})}finally{await C()}else console.log("Deletion cancelled")},z=a=>{v(null,{page:i.value.paginationData.currentPage,"per-page":i.value.paginationData.perPage,q:a})},I=async a=>{await v(null,{page:a,"per-page":i.value.paginationData.perPage}),w(),console.log("Page changed to: ",n.value)},H=async a=>{i.value.paginationData.perPage=a,await v(null,{page:i.value.paginationData.currentPage,"per-page":a}),w()};return X(()=>{v().then(()=>{w()})}),(a,e)=>{const t=$("font-awesome-icon"),s=$("OmniGridView");return ee(),Z("div",ae,[P("div",te,[e[2]||(e[2]=P("div",{class:"col-auto"},[P("h1",{class:"h4 mt-2"},"List of ProjectExpense")],-1)),P("div",oe,[x(V,{type:"submit",customClass:"btn btn-primary",onClick:T},{default:b(()=>e[0]||(e[0]=[U(" New ProjectExpense ")])),_:1})]),x(s,{columns:R,data:i.value,loading:q(N),"action-layout":"inline","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!0,showCreateButton:!1},"expandable-rows":!1,filtering:!1,rowSize:"sm",striped:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!1,"search-in-backend":!0,onView:F,onEdit:G,onDelete:Y,onSearch:z,onChangePage:I,"onUpdate:perPage":H,onRefresh:q(v)},{"left-buttons":b(()=>[x(V,{class:"btn btn-success btn-sm",onClick:T,style:{"font-size":"1.2rem"}},{icon:b(()=>[x(t,{icon:["fas","plus"]})]),default:b(()=>[e[1]||(e[1]=U(" New ProjectExpense "))]),_:1})]),_:1},8,["data","loading","onRefresh"])])])}}};export{pe as default};
