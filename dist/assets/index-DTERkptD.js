import{ap as I,ac as H,av as J,af as p,ag as A,ar as K,aw as Q,ai as k,a3 as W,a4 as X,a5 as v,a7 as w,a8 as y,a9 as G,ah as S,ax as _}from"./index-MPwJWuSk.js";import{_ as T}from"./BaseButton-uLaCJCHy.js";import{_ as x}from"./form-fOSiDTft.js";import{A as Z}from"./AssignmentManager-CZqDdNzS.js";import"./BaseInput-vNhOSAIK.js";/* empty css                                                                  */import"./BaseLabel-BhiMvNwz.js";const aa={class:"card p-3"},ea={class:"row d-flex justify-content-between align-items-center mb-3"},ta={class:"col-auto mb-4"},oa="/v1/iam/rbac/groups",pa={__name:"index",setup(sa){const{proxy:m}=I(),b=H(),o=J(),{data:s,request:g,refresh:P,isLoading:L,error:B}=p(oa,{method:"GET",options:{},autoFetch:!1}),i=A({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:20,totalCount:0,totalPages:0,paginationLinks:{}}}),R=[{key:"name",label:"Name"},{key:"description",label:"Description"}];K(s,()=>{f()});const f=()=>{var a;if((a=s.value)!=null&&a.dataPayload){const e=s.value.dataPayload.data;let t=[];typeof e=="object"&&!Array.isArray(e)?t=Object.values(e):Array.isArray(e)&&(t=e),i.value={data:t,paginationData:{countOnPage:s.value.dataPayload.countOnPage||0,currentPage:s.value.dataPayload.currentPage||1,perPage:s.value.dataPayload.perPage||i.value.paginationData.perPage,totalCount:s.value.dataPayload.totalCount||0,totalPages:s.value.dataPayload.totalPages||0,paginationLinks:s.value.dataPayload.paginationLinks||{}}}}},U=async a=>{var u,l;const e=a.name;if(o.toggleModalUsage(!0),await _(),!o.useModal){b.push({name:"iam/groups/view",params:{id:e}});return}const t=`/v1/iam/rbac/group/${e}`,{data:r,request:n,isLoading:h,error:d}=p(t,{method:"GET",options:{},autoFtech:!0});await n(),o.openModal(x,{formData:((l=(u=r.value)==null?void 0:u.dataPayload)==null?void 0:l.data)||{},error:d,isLoading:h,readonly:!0,hideSubmit:!0},"View Groups")},c=A({}),N=async a=>{var u,l;const e=a.name;if(c.value={},o.toggleModalUsage(!0),await _(),!o.useModal){b.push({name:"iam/groups/update",params:{id:e}});return}const t=`/v1/iam/rbac/group/${e}`,{data:r,request:n,isLoading:h}=p(t,{method:"GET",options:{},autoFtech:!0});await n();const d=async C=>{var $;const{data:M,request:z,error:D}=p(t,{method:"PUT"});if(await z(C),D.value){console.log("Error",D.value),c.value=D.value;return}o.closeModal(),m.$showAlert({title:"Success",icon:"success",text:(($=M.value)==null?void 0:$.alertifypayload.message)??"Group Updated successfully",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),P()};o.openModal(x,{formData:((l=(u=r.value)==null?void 0:u.dataPayload)==null?void 0:l.data)||{},error:c,isLoading:h,readonly:!1,hideSubmit:!1,onSubmit:d},"Edit Groups")},E=async()=>{if(c.value={},o.toggleModalUsage(!0),await _(),!o.useModal){b.push({name:"iam/groups/create"});return}const a=async e=>{const t="/v1/iam/rbac/group",{request:r,error:n}=p(t,{method:"POST"});if(await r(e),n.value){console.log("Error",n.value),c.value=n.value;return}o.closeModal(),m.$showAlert({title:"Success",icon:"success",text:"Groups Created successfully",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),P()};o.openModal(x,{formData:{},error:c,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:a},"Create Groups")},O=async a=>{var d,u;const e=a.name,t=a.is_deleted,r=t?"Restore":"Delete",n=t?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await m.$showAlert({title:"Are you sure?",text:n,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${r} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:l,request:C,isLoading:M}=p(`/v1/iam/rbac/group/${e}`,{method:"DELETE"});await C(),l.value&&await m.$showAlert({title:`${r}d!`,text:((u=(d=l.value)==null?void 0:d.toastPayload)==null?void 0:u.toastMessage)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",B),await m.$showAlert({title:"Error!",text:`Error deleting record: ${B.value}`,icon:"error",showCancelButton:!1})}finally{await P()}else console.log("Deletion cancelled")},V=a=>{g(null,{page:i.value.paginationData.currentPage,"per-page":i.value.paginationData.perPage,_search:a})},q=async a=>{await g(null,{page:a,"per-page":i.value.paginationData.perPage}),f(),console.log("Page changed to: ",s.value)},F=async a=>{i.value.paginationData.perPage=a,await g(null,{page:i.value.paginationData.currentPage,"per-page":a}),f()};Q(()=>{g().then(()=>{f()})});const j=a=>{o.openModal(Z,{entity:a,config:{title:"roles",availableTitle:"Roles",assignedTitle:"Roles",keyField:"name",displayField:"name",getAllEndpoint:"/v1/iam/rbac/roles",getAssignedEndpoint:`/v1/iam/rbac/group/assign/${a.name}`,assignEndpoint:`/v1/iam/rbac/group/assign/${a.name}`,removeEndpoint:`/v1/iam/rbac/group/remove/${a.name}`}},`Manage Roles for ${a.name}`,"xl",!1,{centered:!1,scrollable:!0})},Y=[{key:"manage-group",label:"Manage",icon:["fas","user-group"],callback:a=>j(a),show:!0,colorClass:"text-secondary "}];return(a,e)=>{const t=k("font-awesome-icon"),r=k("OmniGridView");return X(),W("div",aa,[v("div",ea,[e[2]||(e[2]=v("div",{class:"col-auto"},[v("h1",{class:"h4 mt-2"},"List of Groups")],-1)),v("div",ta,[w(T,{type:"submit",customClass:"btn btn-primary",onClick:E},{default:y(()=>e[0]||(e[0]=[G(" New Group ")])),_:1})]),w(r,{columns:R,data:i.value,loading:S(L),dropDownPerPageOptions:[10,25,50],actions:Y,"action-layout":"inline",title:"Group","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!1,showCreateButton:!0},"expandable-rows":!1,filtering:!1,rowSize:"sm",striped:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!0,"search-in-backend":!0,onView:U,onEdit:N,onDelete:O,onSearch:V,onChangePage:q,"onUpdate:perPage":F,onRefresh:S(g)},{"left-buttons":y(()=>[w(T,{class:"btn btn-success btn-sm",onClick:E,style:{"font-size":"1.2rem"}},{icon:y(()=>[w(t,{icon:["fas","plus"]})]),default:y(()=>[e[1]||(e[1]=G(" New Group "))]),_:1})]),_:1},8,["data","loading","onRefresh"])])])}}};export{pa as default};
