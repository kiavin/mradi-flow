import{ap as z,ac as I,av as H,af as m,ag as M,ar as J,aw as K,ai as T,a3 as Q,a4 as W,a5 as b,a6 as X,a7 as C,a8 as D,a9 as Z,ah as $,ax as _}from"./index-KzjOb_BY.js";import{_ as ee}from"./BaseButton-DjYjWSBy.js";import{_ as B}from"./form-D65UMQ9Y.js";import"./BaseInput-DDO6tZOQ.js";/* empty css                                                                  */import"./BaseLabel-BARtHKb3.js";const ae={class:"card p-3"},te={class:"row d-flex justify-content-between align-items-center mb-3"},oe="/v1/iam/rbac/permission",de={__name:"index",setup(se){const{proxy:g}=z(),w=I(),n=H(),{data:i,request:f,refresh:h,isLoading:k,error:x}=m(oe,{method:"GET",options:{},autoFetch:!1}),u=M({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:25,totalCount:0,totalPages:0,paginationLinks:{}}}),A=[{key:"name",label:"Name"},{key:"description",label:"Description"}];J(i,()=>{v()});const v=()=>{var a;if((a=i.value)!=null&&a.dataPayload){const e=i.value.dataPayload.data;let t=[];typeof e=="object"&&!Array.isArray(e)?t=Object.values(e):Array.isArray(e)&&(t=e),u.value={data:t,paginationData:{countOnPage:i.value.dataPayload.countOnPage||0,currentPage:i.value.dataPayload.currentPage||1,perPage:i.value.dataPayload.perPage||u.value.paginationData.perPage,totalCount:i.value.dataPayload.totalCount||0,totalPages:i.value.dataPayload.totalPages||0,paginationLinks:i.value.dataPayload.paginationLinks||{}}}}},N=async a=>{var r,c;const e=a.name;if(n.toggleModalUsage(!0),await _(),!n.useModal){w.push({name:"iam/permissions/view",params:{id:e}});return}const t=`/v1/iam/rbac/permission/${e}`,{data:o,request:s,isLoading:d,error:l}=m(t,{method:"GET",options:{},autoFetch:!0});await s(),n.openModal(B,{formData:((c=(r=o.value)==null?void 0:r.dataPayload)==null?void 0:c.data)||{},error:l,isLoading:d,readonly:!0,hideSubmit:!0},"View Permission")},p=M({}),U=async a=>{var r,c;const e=a.name;if(p.value={},n.toggleModalUsage(!0),await _(),!n.useModal){w.push({name:"iam/permissions/update",params:{id:e}});return}const t=`/v1/iam/rbac/permission/${e}`,{data:o,request:s,isLoading:d}=m(t,{method:"GET",options:{},autoFetch:!0});await s();const l=async P=>{var L,S;const{data:E,request:Y,error:y}=m(t,{method:"PUT"});if(await Y(P),y.value){console.log("Error",y.value),p.value=y.value;return}n.closeModal(),g.$showAlert({title:"Success",icon:"success",text:((S=(L=E.value)==null?void 0:L.alertifypayload)==null?void 0:S.message)??"Permissions Updated successfully",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),h()};n.openModal(B,{formData:((c=(r=o.value)==null?void 0:r.dataPayload)==null?void 0:c.data)||{},error:p,isLoading:d,readonly:!1,hideSubmit:!1,onSubmit:l},"Edit Permission")},V=async()=>{if(p.value={},n.toggleModalUsage(!0),await _(),!n.useModal){w.push({name:"iam/permissions/create"});return}const a=async e=>{var l,r;const t="/v1/iam/permissions",{data:o,request:s,error:d}=m(t,{method:"POST"});if(await s(e),d.value){console.log("Error",d.value),p.value=d.value;return}n.closeModal(),g.$showAlert({title:"Success",icon:"success",text:((r=(l=o.value)==null?void 0:l.alertifypayload)==null?void 0:r.message)??"Permissions Created successfully",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),h()};n.openModal(B,{formData:{},error:p,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:a},"Create Permission")},O=async a=>{var l,r;const e=a.id,t=a.is_deleted,o=t?"Restore":"Delete",s=t?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await g.$showAlert({title:"Are you sure?",text:s,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${o} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:c,request:P,isLoading:E}=m(`/v1/iam/permissions/${e}`,{method:"DELETE"});await P(),c.value&&await g.$showAlert({title:`${o}d!`,text:((r=(l=c.value)==null?void 0:l.toastPayload)==null?void 0:r.toastMessage)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",x),await g.$showAlert({title:"Error!",text:`Error deleting record: ${x.value}`,icon:"error",showCancelButton:!1})}finally{await h()}else console.log("Deletion cancelled")},R=a=>{f(null,{page:u.value.paginationData.currentPage,"per-page":u.value.paginationData.perPage,_search:a})},q=async a=>{await f(null,{page:a,"per-page":u.value.paginationData.perPage}),v(),console.log("Page changed to: ",i.value)},G=async a=>{u.value.paginationData.perPage=a,await f(null,{page:u.value.paginationData.currentPage,"per-page":a}),v()},F=async(a,e)=>{const{request:t,error:o,isLoading:s}=m(a,{method:"PUT"});return await t(e),o.value?{error:o.value.message,isLoading:s.value}:{success:!0,isLoading:s.value,shouldRefresh:!0}},j=[{key:"description",onSave:async(a,e)=>{const t={name:e.name,description:a,...e.ruleName&&{ruleName:e.ruleName}},o=`/v1/iam/rbac/permission/${e.name}`,s=await F(o,t);return h(),s}}];return K(()=>{f().then(()=>{v()})}),(a,e)=>{const t=T("font-awesome-icon"),o=T("OmniGridView");return W(),Q("div",ae,[b("div",te,[e[2]||(e[2]=b("div",{class:"col-auto"},[b("h1",{class:"h4 mt-2"},"List of Permissions")],-1)),X("",!0),C(o,{columns:A,data:u.value,"editable-columns":j,showActionColumn:!1,loading:$(k),dropDownPerPageOptions:[10,25,50],"action-layout":"inline",title:"Permission","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!1,showCreateButton:!1},"expandable-rows":!1,filtering:!1,"multi-select":!1,"radio-select":!1,"break-extra-columns":!0,"search-in-backend":!0,onView:N,onEdit:U,showEdit:!1,onDelete:O,showDelete:!1,onSearch:R,onChangePage:q,"onUpdate:perPage":G,onRefresh:$(f)},{"left-buttons":D(()=>[C(ee,{class:"btn btn-success btn-sm",onClick:V,style:{"font-size":"1.2rem"}},{icon:D(()=>[C(t,{icon:["fas","plus"]})]),default:D(()=>[e[1]||(e[1]=Z(" New Permissions "))]),_:1})]),_:1},8,["data","loading","onRefresh"])])])}}};export{de as default};
