import{e as P}from"./vue3-autocounter.esm-CIoY8sxl.js";import{ay as J,ai as r,al as W,a4 as v,a8 as n,a5 as t,a7 as s,aa as i,a9 as m,ag as g,aw as Q,a3 as y,ah as I,ak as k,aD as O,aN as X,at as Y,af as tt}from"./index-B2eeAoXa.js";const et={components:{Vue3autocounter:P},props:{title:{type:String,default:""},buttonText:{type:String,default:""},buttonLink:{type:String,default:"javascript:void(0);"},amount:{type:[String,Number],default:"0"},description:{type:String,default:""},prefix:{type:String,default:""}}},st={class:"mb-2 d-flex justify-content-between align-items-center"},nt={class:"text-dark"},at={class:"counter"};function ot($,_,d,b,B,D){const w=r("b-badge"),A=r("Vue3autocounter"),C=r("b-card");return v(),W(C,{class:"card-block card-stretch card-height"},{default:n(()=>[t("div",st,[t("span",nt,i(d.title),1),s(w,{tag:"a",variant:" bg-primary-subtle",pill:"",href:d.buttonLink},{default:n(()=>[m(i(d.buttonText),1)]),_:1},8,["href"])]),t("h2",at,[s(A,{ref:"counter",separator:"",prefix:d.prefix,duration:3,startAmount:0,endAmount:d.amount},null,8,["prefix","endAmount"])]),t("small",null,i(d.description),1)]),_:1})}const z=J(et,[["render",ot]]),it={class:"d-flex align-items-start justify-content-between mb-2"},lt={class:"mb-3"},rt={class:"counter text-success"},dt=["src"],ct={class:"mb-1 text-dark"},ut={class:"mb-4"},mt={class:"text-dark"},bt={class:"row"},pt={class:"col-sm-6 mb-3"},_t={class:"d-flex align-items-start gap-3"},ft={class:"bg-info-subtle avatar-50 rounded d-flex align-items-center justify-content-center"},ht={class:"mb-0 text-body"},gt={class:"col-sm-6 mb-3"},vt={class:"d-flex align-items-start gap-3"},xt={class:"bg-success-subtle avatar-50 rounded d-flex align-items-center justify-content-center"},yt={class:"mb-0 text-body"},wt={class:"mt-3 d-flex justify-content-end"},At={class:"col-md-12 col-lg-12"},Nt={class:"overflow-hidden card","data-aos":"fade-up","data-aos-delay":"600"},jt={class:"p-0 card-body"},Lt={class:"mt-4 table-responsive mb-0",style:{"max-height":"580px","overflow-y":"auto"}},St={id:"projects-table",class:"table mb-0 table-striped",role:"grid"},Ct={class:"d-flex align-items-center"},Et=["src"],Tt={class:"mb-2 d-flex align-items-center"},kt={class:"shadow-none progress bg-primary-subtle w-100",style:{height:"4px"}},Pt=["aria-valuenow"],Bt={class:"col-md-12 col-lg-12"},Dt={class:"header-title"},Ft={class:"mb-0 d-flex align-items-center"},Mt={class:"ms-4"},Vt={class:"mb-1"},Rt={class:"fw-bold"},It={class:"text-muted"},Ot={class:"text-muted"},K=25e5,U=15e5,$t={__name:"index",setup($){const _=g({totalProjects:0,totalFinanciers:0,totalExpenses:0,totalContributions:0,totalProjectsBid:0,totalContributed:0,lastUpdated:B(new Date)}),d=g([]),b=g("");function B(c){const e=new Date,a=new Date(c),f=Math.floor((e-a)/1e3),h=[{name:"year",seconds:31536e3},{name:"month",seconds:2592e3},{name:"week",seconds:604800},{name:"day",seconds:86400},{name:"hour",seconds:3600},{name:"minute",seconds:60},{name:"second",seconds:1}];for(const l of h)if(f>=l.seconds){const p=Math.floor(f/l.seconds);return new Intl.RelativeTimeFormat("en",{numeric:"auto"}).format(-p,l.name)}return"just now"}const D=async()=>{var N,j,L,o,S,F,M,V;const{data:c,request:e}=tt("v1/project/report/summary",{method:"GET",autoFetch:!0,autoAlert:!1});await e(),_.value.lastUpdated=new Date().toLocaleString();const a=(j=(N=c.value)==null?void 0:N.dataPayload)==null?void 0:j.data;if(!a){console.warn("Missing dashboard data");return}_.value={totalProjects:Number(a.total_projects),totalExpenses:Number(a.total_expenses),totalFinanciers:Number(a.total_financiers),totalContributions:Number(a.total_contributions),totalProjectsBid:Number(a.total_bid_amount)};const f=(L=a.last_contribution)==null?void 0:L.created_at,h=Number.isFinite(Number(f));b.value={contributor:((o=a.last_contribution)==null?void 0:o.financier_name)||"N/A",avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(((S=a.last_contribution)==null?void 0:S.financier_name)||"N/A")}&background=0D8ABC&color=fff`,project:((F=a.last_contribution)==null?void 0:F.project_name)||"N/A",expense:((M=a.last_contribution)==null?void 0:M.expense_name)||"N/A",amount:Number(((V=a.last_contribution)==null?void 0:V.amount)||0),date:h?new Date(Number(f)*1e3).toISOString():"-"};const l=Number(a.total_contributions||0),p=Number(a.total_expenses||0),x=l+p||1;C.value.series=[Math.round(l/x*100),Math.round(p/x*100)],Array.isArray(a.projects)?d.value=a.projects.map((u,zt)=>{const R=Number(u.bid_amount||0),T=Number(u.sum_expenses||0),H=R===0||T===0?0:Math.round(u.total_contributions/T*100);return{id:u.project_id,name:u.project_name,avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent((u==null?void 0:u.project_name)||"Project")}&background=1AA053&color=fff&bold=true&size=128`,contributions:u.total_contributions,expense:T,contribution:R,contributionPercent:H}}):(console.warn("Expected `projects` to be an array in summary response"),d.value=[])},w={contributions:{series:[{name:"Contributions",data:[5e5,12e5,11e5,2e6,15e5]}],options:{chart:{type:"bar",height:120,toolbar:{show:!1}},plotOptions:{bar:{columnWidth:"45%",borderRadius:4}},colors:["#2dce89","#5e72e4"],xaxis:{categories:["Jan","Feb","Mar","Apr","May"]},dataLabels:{enabled:!1},legend:{show:!1}}}},A=K+U,C=g({series:[Math.round(K/A*100),Math.round(U/A*100)],options:{chart:{height:230,type:"radialBar"},plotOptions:{radialBar:{offsetY:0,startAngle:0,endAngle:270,hollow:{margin:5,size:"30%"},dataLabels:{name:{show:!1},value:{fontSize:"18px",formatter:c=>`${c}%`}}}},colors:["#0d6efd","#dc3545"],labels:["Funding","Spending"],legend:{show:!1}}}),Z=g([{amount:24e5,expense:"Land Purchase",contributor:"Equity Bank",project:"Kibera Housing",date:"2025-09-10T20:10:00Z"},{amount:15e4,expense:"Licensing",contributor:"NCBA",project:"Machakos Expansion",date:"2025-09-09T23:00:00Z"}]),q=g(16);function E(c){return new Intl.NumberFormat("en-KE").format(c)}function G(c){const e=new Date(c);return`${e.toLocaleDateString()} at ${e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}return Q(D),(c,e)=>{const a=r("b-badge"),f=r("apexchart"),h=r("b-card"),l=r("b-col"),p=r("b-row"),x=r("font-awesome-icon"),N=r("b-button"),j=r("b-card-header"),L=r("b-card-body");return v(),y(k,null,[e[14]||(e[14]=t("div",{class:"d-flex justify-content-between align-items-center flex-wrap mb-4 gap-3"},[t("div",{class:"d-flex flex-column"},[t("h3",null,"Quick Insights"),t("p",{class:"text-primary mb-0"},"Financial Dashboard")])],-1)),s(p,null,{default:n(()=>[s(l,{lg:"3",md:"6"},{default:n(()=>[s(h,{class:"card-block card-stretch card-height"},{default:n(()=>[t("div",it,[e[1]||(e[1]=t("p",{class:"mb-0 text-dark"},"Total Contributions",-1)),s(a,{tag:"a",variant:"bg-primary-subtle",class:"badge rounded-pill",href:"javascript:void(0);"},{default:n(()=>e[0]||(e[0]=[m(" View ")])),_:1})]),t("div",lt,[t("h2",rt,[s(I(P),{ref:"contributionCounter",separator:",",prefix:"KES ",duration:3,startAmount:0,endAmount:_.value.totalContributions},null,8,["endAmount"])]),t("small",null,"Updated "+i(_.value.lastUpdated),1)]),t("div",null,[s(f,{height:"100%",type:"bar",options:w.contributions.options,series:w.contributions.series},null,8,["options","series"])])]),_:1})]),_:1}),s(l,{lg:"3",md:"6"},{default:n(()=>[s(p,{class:"row"},{default:n(()=>[s(l,{cols:"12"},{default:n(()=>[s(z,{title:"Total Project Bids",amount:_.value.totalProjectsBid,description:"Registered under this project",icon:"box","button-text":"View"},null,8,["amount"])]),_:1}),s(l,{cols:"12"},{default:n(()=>[s(z,{prefix:"KES ",title:"Total Expenses",amount:_.value.totalExpenses,description:"Project Bid Amount",icon:"file-invoice-dollar","button-text":"View"},null,8,["amount"])]),_:1})]),_:1})]),_:1}),s(l,{lg:"6",md:"12"},{default:n(()=>[s(h,{class:"shadow-sm border-0"},{default:n(()=>[s(a,{tag:"a",variant:" bg-primary-subtle",class:"badge rounded-pill",href:"javascript:void(0);"},{default:n(()=>e[2]||(e[2]=[m(" Last Transaction ")])),_:1}),s(p,null,{default:n(()=>[s(l,{md:"4",class:"d-flex flex-column align-items-center justify-content-center text-center p-4 border-end"},{default:n(()=>[t("img",{src:b.value.avatar,alt:"contributor",class:"rounded-circle shadow avatar-100 mb-3 bg-light",style:{"object-fit":"cover"}},null,8,dt),t("h5",ct,i(b.value.contributor),1),e[3]||(e[3]=t("p",{class:"text-muted mb-2"},"Financier",-1)),s(a,{variant:"primary-subtle",pill:""},{default:n(()=>[m(i(b.value.date),1)]),_:1})]),_:1}),s(l,{md:"8",class:"p-4"},{default:n(()=>[t("div",ut,[e[4]||(e[4]=t("h6",{class:"text-muted mb-1"},"Amount Contributed",-1)),t("h2",mt,[s(I(P),{ref:"counter",separator:",",prefix:"KES ",duration:3,startAmount:0,endAmount:b.value.amount},null,8,["endAmount"])])]),t("div",bt,[t("div",pt,[t("div",_t,[t("div",ft,[s(x,{icon:"building",size:"lg",class:"text-info"})]),t("div",null,[e[5]||(e[5]=t("p",{class:"mb-1 text-muted"},"Project",-1)),t("h6",ht,i(b.value.project),1)])])]),t("div",gt,[t("div",vt,[t("div",xt,[s(x,{icon:"box",size:"lg",class:"text-success"})]),t("div",null,[e[6]||(e[6]=t("p",{class:"mb-1 text-muted"},"Expense",-1)),t("h6",yt,i(b.value.expense),1)])])])]),t("div",wt,[s(N,{variant:"soft-primary",size:"sm"},{default:n(()=>e[7]||(e[7]=[m(" View Full Report ")])),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),s(l,{lg:"8",md:"12"},{default:n(()=>[t("div",At,[t("div",Nt,[e[9]||(e[9]=t("div",{class:"flex-wrap card-header d-flex justify-content-between"},[t("div",{class:"header-title"},[t("h4",{class:"mb-2 card-title"},"Projects Financial Overview"),t("p",{class:"mb-0"},[t("svg",{class:"me-2 text-primary",width:"24",height:"24",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"})]),m(" Insights from latest project contributions ")])])],-1)),t("div",jt,[t("div",Lt,[t("table",St,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",null,"PROJECT"),t("th",null,"TOTAL EXPENSE"),t("th",null,"CONTRIBUTIONS"),t("th",null,"CONTRIBUTION %")])],-1)),t("tbody",null,[(v(!0),y(k,null,O(d.value,o=>(v(),y("tr",{key:o.id},[t("td",null,[t("div",Ct,[t("img",{class:"rounded bg-primary-subtle img-fluid avatar-40 me-3",src:o.avatar,alt:"project"},null,8,Et),t("h6",null,i(o.name),1)])]),t("td",null,"KES "+i(E(o.expense)),1),t("td",null,[t("td",null,"KES "+i(E(o.contributions)),1)]),t("td",null,[t("div",Tt,[t("h6",null,i(o.contributionPercent)+"%",1)]),t("div",kt,[t("div",{class:Y(["progress-bar",o.contributionPercent>=100?"bg-success":"bg-primary"]),role:"progressbar",style:X({width:o.contributionPercent+"%"}),"aria-valuenow":o.contributionPercent,"aria-valuemin":"0","aria-valuemax":"100"},null,14,Pt)])])]))),128))])])])])])])]),_:1}),s(l,{lg:"4",md:"12"},{default:n(()=>[t("div",Bt,[s(h,{"no-body":"",class:"aos-init aos-animate","data-aos":"fade-up","data-aos-delay":"600"},{default:n(()=>[s(j,{class:"d-flex justify-content-between flex-wrap"},{default:n(()=>[t("div",Dt,[e[11]||(e[11]=t("h4",{class:"mb-2 card-title"},"Activity Overview",-1)),t("p",Ft,[e[10]||(e[10]=t("svg",{class:"me-2",width:"24",height:"24",viewBox:"0 0 24 24"},[t("path",{fill:"#17904b",d:"M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z"})],-1)),m(" "+i(q.value)+"% this month ",1)])])]),_:1}),s(L,{style:{"max-height":"600px","overflow-y":"auto"}},{default:n(()=>[(v(!0),y(k,null,O(Z.value,(o,S)=>(v(),y("div",{key:S,class:"mb-3 d-flex profile-media align-items-top"},[e[13]||(e[13]=t("div",{class:"mt-1 profile-dots-pills border-primary"},null,-1)),t("div",Mt,[t("h6",Vt,[t("span",Rt,"KES "+i(E(o.amount)),1),e[12]||(e[12]=m(", ")),t("span",It,i(o.expense),1)]),t("small",Ot,[m(i(G(o.date))+" – by "+i(o.contributor)+" for ",1),t("strong",null,i(o.project),1)])])]))),128))]),_:1})]),_:1})])]),_:1})]),_:1})],64)}}};export{$t as default};
