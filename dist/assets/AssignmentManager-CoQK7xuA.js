import{ai as te,ad as ae,aw as ie,ag as _,ax as oe,az as le,aA as m,af as Q,an as ne,a3 as o,a4 as l,a5 as s,a6 as v,aa as p,ap as y,a7 as r,ah as u,aB as g,aC as I,al as C,aD as L,au as z,a9 as M}from"./index-CTt-D8ZI.js";const de={class:"container-fluid p-3"},ce={key:0,class:"d-flex flex-column gap-3"},re={class:"card shadow-sm"},ue={class:"card-header bg-light"},ge={class:"mb-0"},ve={class:"card-body p-2"},pe={class:"input-group mb-3"},he={class:"input-group-text"},fe=["placeholder"],be={class:"list-group overflow-auto",style:{"max-height":"40vh"}},me={key:0,class:"list-group-item list-group-item-action"},ye=["onClick"],_e={key:0,class:"text-muted"},ke={key:0,class:"badge bg-primary rounded-pill"},we={class:"d-grid gap-2 d-md-flex justify-content-center"},xe=["disabled"],Ae=["disabled"],Ce={class:"card shadow-sm"},Fe={class:"card-header bg-light"},Se={class:"mb-0"},Te={class:"card-body p-2"},Ee={class:"input-group mb-3"},je={class:"input-group-text"},Ie=["placeholder"],Le={class:"list-group overflow-auto",style:{"max-height":"40vh"}},ze={key:0,class:"list-group-item list-group-item-action"},Me=["onClick"],Ne={key:0,class:"text-muted"},Ve={key:0,class:"badge bg-primary rounded-pill"},De={class:"d-grid gap-2 d-md-flex justify-content-center"},Be=["disabled"],Oe=["disabled"],Pe={key:1,class:"row"},Re={class:"col-lg-5 col-xl-5"},Ue={class:"card shadow-sm h-100"},qe={class:"card-header bg-light d-flex align-items-center justify-content-center py-3 border-top rounded-top"},$e={class:"mb-0"},We={class:"card-body d-flex flex-column p-0"},Ge={class:"input-group mb-3 px-3 pt-3"},He={class:"input-group-text"},Je=["placeholder"],Ke={class:"list-group overflow-auto",style:{"max-height":"60vh","min-height":"200px"}},Qe={key:0,class:"list-group-item list-group-item-action"},Xe=["onClick"],Ye={key:0,class:"fw-bold"},Ze={key:0,class:"badge bg-primary rounded-pill"},es={class:"col-lg-2 col-xl-2 d-flex flex-column justify-content-center px-0"},ss={class:"d-grid gap-2 mx-auto",style:{width:"fit-content"}},ts=["disabled"],as=["disabled"],is=["disabled"],os=["disabled"],ls={class:"col-lg-5 col-xl-5"},ns={class:"card shadow-sm h-100"},ds={class:"card-header bg-light d-flex align-items-center justify-content-center py-3 border-top rounded-top"},cs={class:"mb-0"},rs={class:"card-body d-flex flex-column p-0"},us={class:"input-group mb-3 px-3 pt-3"},gs={class:"input-group-text"},vs=["placeholder"],ps={class:"list-group overflow-auto",style:{"max-height":"60vh","min-height":"200px"}},hs={key:0,class:"list-group-item list-group-item-action"},fs=["onClick"],bs={key:0,class:"fw-bold"},ms={key:0,class:"badge bg-primary rounded-pill"},ys={key:0,class:"loading-overlay d-flex align-items-center justify-content-center"},_s={__name:"AssignmentManager",props:{entity:{type:Object,required:!0},config:{type:Object,required:!0,validator:d=>["title","availableTitle","assignedTitle","keyField","displayField","getAllEndpoint","getAssignedEndpoint","assignEndpoint","removeEndpoint"].every(N=>N in d)},isLoading:Boolean,error:Object},emits:["close","refresh"],setup(d,{emit:N}){const X=ae(),Y=ie(),n=d,Z=N,k=_([]),h=_([]),f=_([]),w=_(""),x=_(""),O=_(window.innerWidth<768),P=()=>{O.value=window.innerWidth<768};oe(()=>{window.addEventListener("resize",P),A()}),le(()=>{window.removeEventListener("resize",P)});const V=m(()=>{var t,i;if(!k.value.length)return[];const a=((i=(t=k.value[0])==null?void 0:t.items)==null?void 0:i.available)||{};return Object.entries(a).map(([e,c])=>({[n.config.keyField]:e,[n.config.displayField]:e,type:c,description:e}))}),D=m(()=>{var t,i;if(!k.value.length)return[];const a=((i=(t=k.value[0])==null?void 0:t.items)==null?void 0:i.assigned)||{};return Object.entries(a).map(([e,c])=>({[n.config.keyField]:e,[n.config.displayField]:e,type:c,description:e}))}),R=m(()=>{const a=w.value.toLowerCase();return V.value.filter(t=>t[n.config.displayField].toLowerCase().includes(a)||t.description&&t.description.toLowerCase().includes(a))}),U=m(()=>{const a=x.value.toLowerCase();return D.value.filter(t=>t[n.config.displayField].toLowerCase().includes(a)||t.description&&t.description.toLowerCase().includes(a))}),q=m(()=>h.value.length>0),$=m(()=>f.value.length>0),F=m(()=>V.value.length>0),S=m(()=>D.value.length>0),A=async()=>{var a,t;try{const i=typeof n.config.getAllEndpoint=="function"?n.config.getAllEndpoint(n.entity):n.config.getAllEndpoint,{data:e,request:c}=Q(i,{method:"GET"});await c(),k.value=(t=(a=e.value)==null?void 0:a.dataPayload)!=null&&t.data?[e.value.dataPayload.data]:[]}catch(i){console.error("Error fetching data:",i)}},b=(a,t)=>(t==="available"?h.value:f.value).some(e=>e[n.config.keyField]===a[n.config.keyField]),T=(a,t,i=null)=>{i==null||i.stopPropagation(),i==null||i.preventDefault();const e=t==="available"?h:f,c=n.config.keyField,K=e.value.findIndex(se=>se[c]===a[c]);K===-1?e.value.push({...a,[c]:a[c]}):e.value.splice(K,1)},B=_(!1),E=async(a,t)=>{B.value=!0;try{const{data:i,request:e}=Q(a,{method:"POST"});await e(t),X.show(i==null?void 0:i.value),Z("refresh")}catch(i){console.error("Error updating assignments:",i)}finally{B.value=!1}},j=n.config.title,W=async()=>{if(h.value.length===0)return;const a={[j]:h.value.map(t=>t[n.config.keyField])};await E(n.config.assignEndpoint,a),h.value=[],await A()},G=async()=>{const a={[j]:V.value.map(t=>t[n.config.keyField])};await E(n.config.assignEndpoint,a),h.value=[],await A()},H=async()=>{if(f.value.length===0)return;const a={[j]:f.value.map(t=>t[n.config.keyField])};await E(n.config.removeEndpoint,a),f.value=[],await A()},J=async()=>{const a={[j]:D.value.map(t=>t[n.config.keyField])};await E(n.config.removeEndpoint,a),f.value=[],await A()},ee=()=>{h.value=[],f.value=[],Y.closeModal()};return(a,t)=>{const i=ne("tooltip");return l(),o(C,null,[s("div",de,[O.value?(l(),o("div",ce,[s("div",re,[s("div",ue,[s("h5",ge,"Available "+p(d.config.availableTitle),1)]),s("div",ve,[s("div",pe,[s("span",he,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),type:"text",class:"form-control",placeholder:`Search ${d.config.availableTitle.toLowerCase()}...`},null,8,fe),[[I,w.value]])]),s("div",be,[F.value?v("",!0):(l(),o("div",me," No "+p(d.config.availableTitle)+" available. ",1)),(l(!0),o(C,null,L(R.value,e=>(l(),o("div",{key:e[d.config.keyField],class:z(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"available")}]),onClick:c=>T(e,"available",c)},[s("div",null,[e.description?(l(),o("small",_e,p(e.description),1)):v("",!0)]),b(e,"available")?(l(),o("span",ke,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,ye))),128))])])]),s("div",we,[s("button",{onClick:W,class:"btn btn-primary",disabled:!q.value},[r(u(g),{icon:["fas","arrow-down"],class:"me-1"}),t[4]||(t[4]=M(" Assign Selected "))],8,xe),s("button",{onClick:G,class:"btn btn-outline-primary",disabled:!F.value},[r(u(g),{icon:["fas","angles-down"],class:"me-1"}),t[5]||(t[5]=M(" Assign All "))],8,Ae)]),s("div",Ce,[s("div",Fe,[s("h5",Se,"Assigned "+p(d.config.assignedTitle),1)]),s("div",Te,[s("div",Ee,[s("span",je,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),type:"text",class:"form-control",placeholder:`Search assigned ${d.config.assignedTitle.toLowerCase()}...`},null,8,Ie),[[I,x.value]])]),s("div",Le,[S.value?v("",!0):(l(),o("div",ze," No "+p(d.config.assignedTitle)+" assigned. ",1)),(l(!0),o(C,null,L(U.value,e=>(l(),o("div",{key:e[d.config.keyField],class:z(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"assigned")}]),onClick:c=>T(e,"assigned",c)},[s("div",null,[e.description?(l(),o("small",Ne,p(e.description),1)):v("",!0)]),b(e,"assigned")?(l(),o("span",Ve,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,Me))),128))])])]),s("div",De,[s("button",{onClick:H,class:"btn btn-danger",disabled:!$.value},[r(u(g),{icon:["fas","arrow-up"],class:"me-1"}),t[6]||(t[6]=M(" Remove Selected "))],8,Be),s("button",{onClick:J,class:"btn btn-outline-danger",disabled:!S.value},[r(u(g),{icon:["fas","angles-up"],class:"me-1"}),t[7]||(t[7]=M(" Remove All "))],8,Oe)]),s("div",{class:"d-grid gap-2 d-md-flex justify-content-end mt-2"},[s("button",{onClick:ee,class:"btn btn-outline-secondary"},"Cancel")])])):(l(),o("div",Pe,[s("div",Re,[s("div",Ue,[s("div",qe,[s("h5",$e,"Available "+p(d.config.availableTitle),1)]),s("div",We,[s("div",Ge,[s("span",He,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),type:"text",class:"form-control",placeholder:`Search ${d.config.availableTitle.toLowerCase()}...`},null,8,Je),[[I,w.value]])]),s("div",Ke,[F.value?v("",!0):(l(),o("div",Qe," No "+p(d.config.availableTitle)+" available. ",1)),(l(!0),o(C,null,L(R.value,e=>(l(),o("div",{key:e[d.config.keyField],class:z(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"available")}]),onClick:c=>T(e,"available",c)},[s("div",null,[e.description?(l(),o("small",Ye,p(e.description),1)):v("",!0)]),b(e,"available")?(l(),o("span",Ze,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,Xe))),128))])])])]),s("div",es,[s("div",ss,[y((l(),o("button",{onClick:W,class:"btn btn-success p-2",disabled:!q.value},[r(u(g),{icon:["fas","arrow-right"],size:"lg"})],8,ts)),[[i,"Assign Selected","top"]]),y((l(),o("button",{onClick:G,class:"btn btn-outline-success p-2",title:"",disabled:!F.value},[r(u(g),{icon:["fas","angles-right"],size:"lg"})],8,as)),[[i,"Assign All","bottom"]]),t[8]||(t[8]=s("div",{class:"my-2 border-bottom"},null,-1)),y((l(),o("button",{onClick:H,class:"btn btn-danger p-2",disabled:!$.value},[r(u(g),{icon:["fas","arrow-left"],size:"lg"})],8,is)),[[i,"Remove Selected","top"]]),y((l(),o("button",{onClick:J,class:"btn btn-outline-danger p-2",disabled:!S.value},[r(u(g),{icon:["fas","angles-left"],size:"lg"})],8,os)),[[i,"Remove All","bottom"]])])]),s("div",ls,[s("div",ns,[s("div",ds,[s("h5",cs,"Assigned "+p(d.config.assignedTitle),1)]),s("div",rs,[s("div",us,[s("span",gs,[r(u(g),{icon:["fas","search"]})]),y(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>x.value=e),type:"text",class:"form-control",placeholder:`Search assigned ${d.config.assignedTitle.toLowerCase()}...`},null,8,vs),[[I,x.value]])]),s("div",ps,[S.value?v("",!0):(l(),o("div",hs," No "+p(d.config.assignedTitle)+" assigned. ",1)),(l(!0),o(C,null,L(U.value,e=>(l(),o("div",{key:e[d.config.keyField],class:z(["list-group-item list-group-item-action d-flex justify-content-between align-items-start",{active:b(e,"assigned")}]),onClick:c=>T(e,"assigned",c)},[s("div",null,[e.description?(l(),o("small",bs,p(e.description),1)):v("",!0)]),b(e,"assigned")?(l(),o("span",ms,[r(u(g),{icon:["fas","check"]})])):v("",!0)],10,fs))),128))])])])])]))]),B.value?(l(),o("div",ys,t[9]||(t[9]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):v("",!0)],64)}}},ws=te(_s,[["__scopeId","data-v-ee40f8cd"]]);export{ws as A};
