import{ap as W,ac as X,ag as h,av as Z,af as v,ar as aa,aw as ea,ai as M,a3 as ta,a4 as oa,a5 as m,a7 as D,a8 as f,a9 as F,aa as C,ah as $,ax as O}from"./index-C9QpY-AJ.js";import{_ as q}from"./BaseButton-60wcncwt.js";import{_ as U}from"./form-BokzKe9D.js";import"./SelectComponent-jbS4Klq4.js";const na={class:"card p-3"},sa={class:"row d-flex justify-content-between align-items-center mb-3"},ra={class:"col-auto mb-4"},la={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},ia={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},ca={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},ua={class:"text-end font-monospace",style:{"font-variant-numeric":"tabular-nums","max-width":"150px !important"}},da="/v1/project/projects",R="/v1/project/financiers",ha={__name:"index",setup(pa){const{proxy:j}=W(),E=X(),A=h(!0),k=h(null);h(null);const u=Z(),{data:i,request:y,refresh:B,isLoading:V,error:N}=v(da,{method:"GET",options:{},autoFetch:!1}),d=h({data:[],paginationData:{countOnPage:0,currentPage:1,perPage:25,totalCount:0,totalPages:0,paginationLinks:{}}}),G=[{key:"name",label:"Name",class:"text-center"},{key:"bid_amount",label:"Bid Amount",class:"text-center"},{key:"total_expense_amount",label:"Total Expenses",class:"text-center"},{key:"total_contributed_amount",label:"Total Contributions",class:"text-center"},{key:"deficit",label:"Deficit",class:"text-center"}],_=e=>{const a=Number(e);return isNaN(a)?"-":a.toLocaleString("en-KE")},b=h([]);aa(i,()=>{w()});const w=()=>{var e;if((e=i.value)!=null&&e.dataPayload){const a=i.value.dataPayload.data;let n=[],o=[];typeof a=="object"&&!Array.isArray(a)?n=Object.values(a):Array.isArray(a)&&(o=a,n=o.map(t=>{const s=Number(t.total_expense_amount)||0,r=Number(t.total_expenses)||0,c=s-r;return{...t,bid_amount:Number(t.bid_amount)||0,total_expense_amount:s,total_expenses:r,deficit:c}})),d.value={data:n,paginationData:{countOnPage:i.value.dataPayload.countOnPage||0,currentPage:i.value.dataPayload.currentPage||1,perPage:i.value.dataPayload.perPage||d.value.paginationData.perPage,totalCount:i.value.dataPayload.totalCount||0,totalPages:i.value.dataPayload.totalPages||0,paginationLinks:i.value.dataPayload.paginationLinks||{}}}}},Y=async e=>{const a=e.id;E.push({name:"projectDashboard",params:{id:a}})},g=h({}),z=async e=>{var r,c,l,x;const a=e.id;if(g.value={},u.toggleModalUsage(!0),await O(),!u.useModal){E.push({name:"project/project/update",params:{id:a}});return}const n=async p=>{const{request:T,error:P}=v(o,{method:"PUT"});if(await T(p),P.value){console.log("Error",P.value),g.value=P.value;return}u.closeModal(),B()};u.openModal(U,{formData:k,error:g,isLoading:A,prefill:!0,Financiers:b,readonly:!1,hideSubmit:!1,onSubmit:n},"Edit Project");const o=`/v1/project/project/${a}`,{data:t,request:s}=v(o,{method:"GET",autoFetch:!0,autoAlert:!0});try{A.value=!0,await s(),k.value=((c=(r=t==null?void 0:t.value)==null?void 0:r.dataPayload)==null?void 0:c.data)||{};const{data:p,request:T,error:P}=v(R,{method:"GET",autoFetch:!0,autoAlert:!1});await T(),Array.isArray((x=(l=p.value)==null?void 0:l.dataPayload)==null?void 0:x.data)?b.value=p.value.dataPayload.data.map(L=>({value:L.id,label:L.name})):console.warn("Could not load financiers:",p.value)}catch(p){console.error("Failed to fetch edit data",p),g.value.general="Could not load project data."}finally{A.value=!1}},S=async()=>{var o,t;if(g.value={},u.toggleModalUsage(!0),await O(),!u.useModal){E.push({name:"project/project/create"});return}const{data:e,request:a}=v(R,{method:"GET",autoFetch:!0,autoAlert:!1});await a(),Array.isArray((t=(o=e.value)==null?void 0:o.dataPayload)==null?void 0:t.data)?b.value=e.value.dataPayload.data.map(s=>({value:s.id,label:s.name})):console.warn("Could not load financiers:",e.value);const n=async s=>{const r="/v1/project/project",{request:c,error:l}=v(r,{method:"POST",autoAlert:!0});if(await c(s),l.value){console.log("Error",l.value),g.value=l.value;return}u.closeModal(),B()};u.openModal(U,{formData:{},error:g,Financiers:b.value,isLoading:!1,readonly:!1,hideSubmit:!1,onSubmit:n},"Create Project")},I=async e=>{var r,c;const a=e.id,n=e.is_deleted,o=n?"Restore":"Delete",t=n?"You are about to restore this record. Do you want to proceed?":"You are about to delete this record. Do you want to proceed?";if((await j.$showAlert({title:"Are you sure?",text:t,icon:"warning",showConfirmButton:!0,confirmButtonText:`Yes, ${o} it!`,cancelButtonText:"No, cancel!",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed)try{const{data:l,request:x,isLoading:p}=v(`/v1/project/project/${a}`,{method:"DELETE"});await x(),l.value&&await j.$showAlert({title:`${o}d!`,text:((c=(r=l.value)==null?void 0:r.alertifyPayload)==null?void 0:c.message)||"Record deleted successfully",icon:"success",showCancelButton:!1,showConfirmButton:!1,timer:1500})}catch{console.error("Error deleting record:",N),await j.$showAlert({title:"Error!",text:`Error deleting record: ${N.value}`,icon:"error",showCancelButton:!1})}finally{await B()}else console.log("Deletion cancelled")},K=e=>{y(null,{page:d.value.paginationData.currentPage,"per-page":d.value.paginationData.perPage,q:e})},H=async e=>{await y(null,{page:e,"per-page":d.value.paginationData.perPage}),w()},J=async e=>{d.value.paginationData.perPage=e,await y(null,{page:d.value.paginationData.currentPage,"per-page":e}),w()},Q=[];return ea(()=>{y().then(()=>{w()})}),(e,a)=>{const n=M("font-awesome-icon"),o=M("OmniGridView");return oa(),ta("div",na,[m("div",sa,[a[2]||(a[2]=m("div",{class:"col-auto"},[m("h1",{class:"h4 mt-2"},"List of Project")],-1)),m("div",ra,[D(q,{type:"submit",customClass:"btn btn-primary",onClick:S},{default:f(()=>a[0]||(a[0]=[F(" New Project ")])),_:1})]),D(o,{columns:G,data:d.value,loading:$(V),"action-layout":"inline","pagination-config":{variant:"circle",position:"right",bgColor:"#4f46e5",hoverBgColor:"#6366f1",textColor:"#374151",activeTextColor:"#ffffff",showFirstLast:!0,showNumbers:!0,showTotal:!0,showRange:!0},toolbar:{show:!1},"expandable-rows":!1,filtering:!1,rowSize:"sm",striped:!1,dropDownPerPageOptions:[5,10,25,50],"multi-select":!1,"radio-select":!1,"break-extra-columns":!1,"search-in-backend":!0,showEdit:!0,showDelete:!1,actions:Q,onView:Y,onEdit:z,onDelete:I,onSearch:K,onChangePage:H,"onUpdate:perPage":J,onRefresh:$(y)},{"left-buttons":f(()=>[D(q,{class:"btn btn-success btn-sm",onClick:S,style:{"font-size":"1.2rem"}},{icon:f(()=>[D(n,{icon:["fas","plus"]})]),default:f(()=>[a[1]||(a[1]=F(" New Project "))]),_:1})]),"column-bid_amount":f(({row:t})=>[m("div",la,C(_(t.bid_amount)),1)]),"column-total_expense_amount":f(({row:t})=>[m("div",ia,C(_(t.total_expense_amount)),1)]),"column-total_contributed_amount":f(({row:t})=>[m("div",ca,C(_(t.total_contributed_amount)),1)]),"column-deficit":f(({row:t})=>[m("div",ua,C(_(t.deficit)),1)]),_:1},8,["data","loading","onRefresh"])])])}}};export{ha as default};
